2019-09-16 11:37:37.213 +07:00 [FTL] Application startup exception
System.Exception: need to configure key material
   at IdentityServer.Startup.ConfigureServices(IServiceCollection services) in D:\Project\identityserver\src\IdentityServer\Startup.cs:line 88
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.ConfigureServices(IServiceCollection services)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.EnsureApplicationServices()
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.Initialize()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2019-09-16 11:37:37.276 +07:00 [DBG] Starting grant removal
2019-09-16 11:45:19.781 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 11:45:19.790 +07:00 [DBG] Stopping grant removal
2019-09-16 11:54:47.682 +07:00 [FTL] Application startup exception
System.Exception: need to configure key material
   at IdentityServer.Startup.ConfigureServices(IServiceCollection services) in D:\Project\identityserver\src\IdentityServer\Startup.cs:line 88
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.ConfigureServices(IServiceCollection services)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.EnsureApplicationServices()
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.Initialize()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2019-09-16 11:54:47.746 +07:00 [DBG] Starting grant removal
2019-09-16 11:58:30.533 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 11:58:30.554 +07:00 [DBG] Stopping grant removal
2019-09-16 11:58:38.429 +07:00 [FTL] Application startup exception
System.Exception: need to configure key material
   at IdentityServer.Startup.ConfigureServices(IServiceCollection services) in D:\Project\identityserver\src\IdentityServer\Startup.cs:line 88
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.ConfigureServices(IServiceCollection services)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.EnsureApplicationServices()
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.Initialize()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2019-09-16 11:58:38.492 +07:00 [DBG] Starting grant removal
2019-09-16 12:19:37.225 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 12:19:37.249 +07:00 [DBG] Stopping grant removal
2019-09-16 12:25:27.487 +07:00 [FTL] Application startup exception
System.Exception: need to configure key material
   at IdentityServer.Startup.ConfigureServices(IServiceCollection services) in D:\Project\identityserver\src\IdentityServer\Startup.cs:line 88
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.ConfigureServices(IServiceCollection services)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.EnsureApplicationServices()
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.Initialize()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2019-09-16 12:25:27.554 +07:00 [DBG] Starting grant removal
2019-09-16 12:28:39.225 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 12:28:39.234 +07:00 [DBG] Stopping grant removal
2019-09-16 13:07:26.851 +07:00 [FTL] Application startup exception
System.Exception: need to configure key material
   at IdentityServer.Startup.ConfigureServices(IServiceCollection services) in D:\Project\identityserver\src\IdentityServer\Startup.cs:line 88
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.ConfigureServices(IServiceCollection services)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.EnsureApplicationServices()
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.Initialize()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2019-09-16 13:07:26.916 +07:00 [DBG] Starting grant removal
2019-09-16 13:10:58.398 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 13:10:58.407 +07:00 [DBG] Stopping grant removal
2019-09-16 13:11:59.459 +07:00 [FTL] Application startup exception
System.Exception: need to configure key material
   at IdentityServer.Startup.ConfigureServices(IServiceCollection services) in D:\Project\identityserver\src\IdentityServer\Startup.cs:line 88
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.ConfigureServices(IServiceCollection services)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.EnsureApplicationServices()
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.Initialize()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2019-09-16 13:11:59.524 +07:00 [DBG] Starting grant removal
2019-09-16 13:16:25.681 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 13:16:25.691 +07:00 [DBG] Stopping grant removal
2019-09-16 13:16:58.102 +07:00 [FTL] Application startup exception
System.Exception: need to configure key material
   at IdentityServer.Startup.ConfigureServices(IServiceCollection services) in D:\Project\identityserver\src\IdentityServer\Startup.cs:line 88
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.ConfigureServices(IServiceCollection services)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.EnsureApplicationServices()
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.Initialize()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2019-09-16 13:16:58.167 +07:00 [DBG] Starting grant removal
2019-09-16 13:37:27.430 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 13:37:27.442 +07:00 [DBG] Stopping grant removal
2019-09-16 13:40:20.073 +07:00 [FTL] Application startup exception
System.InvalidOperationException: certificate: 'CN=sts' not found in certificate store
   at Microsoft.Extensions.DependencyInjection.IdentityServerBuilderExtensionsCrypto.AddSigningCredential(IIdentityServerBuilder builder, String name, StoreLocation location, NameType nameType)
   at IdentityServer.Startup.ConfigureServices(IServiceCollection services) in D:\Project\identityserver\src\IdentityServer\Startup.cs:line 87
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.ConfigureServices(IServiceCollection services)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.EnsureApplicationServices()
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.Initialize()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2019-09-16 13:40:20.135 +07:00 [DBG] Starting grant removal
2019-09-16 13:59:48.883 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 13:59:48.893 +07:00 [DBG] Stopping grant removal
2019-09-16 14:02:48.047 +07:00 [WRN] Using an in-memory repository. Keys will not be persisted to storage.
2019-09-16 14:02:48.070 +07:00 [WRN] Neither user profile nor HKLM registry available. Using an ephemeral key repository. Protected data will be unavailable when application exits.
2019-09-16 14:02:48.082 +07:00 [WRN] No XML encryptor configured. Key "ea66bbb4-060a-46c0-baae-9fabdb5afdac" may be persisted to storage in unencrypted form.
2019-09-16 14:02:49.515 +07:00 [INF] Starting IdentityServer4 version 2.5.0.0
2019-09-16 14:02:49.531 +07:00 [INF] Using the default authentication scheme idsrv for IdentityServer
2019-09-16 14:02:49.531 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for authentication
2019-09-16 14:02:49.531 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-in
2019-09-16 14:02:49.531 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-out
2019-09-16 14:02:49.531 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for challenge
2019-09-16 14:02:49.531 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for forbid
2019-09-16 14:02:49.618 +07:00 [DBG] Starting grant removal
2019-09-16 14:02:49.989 +07:00 [DBG] Login Url: /Account/Login
2019-09-16 14:02:49.991 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-09-16 14:02:49.991 +07:00 [DBG] Logout Url: /Account/Logout
2019-09-16 14:02:49.991 +07:00 [DBG] ConsentUrl Url: /consent
2019-09-16 14:02:49.991 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2019-09-16 14:02:49.991 +07:00 [DBG] Error Url: /home/error
2019-09-16 14:02:49.991 +07:00 [DBG] Error Id Parameter: errorId
2019-09-16 14:02:50.097 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:51.654 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:52.323 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:52.499 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:52.706 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:52.872 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:53.028 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:53.207 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:53.364 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:53.539 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:53.700 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:53.891 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:54.095 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:54.278 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:54.469 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:54.674 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:54.842 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:55.013 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:02:57.996 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:03:03.702 +07:00 [DBG] Stopping grant removal
2019-09-16 14:03:03.702 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 14:04:36.063 +07:00 [WRN] Using an in-memory repository. Keys will not be persisted to storage.
2019-09-16 14:04:36.105 +07:00 [WRN] Neither user profile nor HKLM registry available. Using an ephemeral key repository. Protected data will be unavailable when application exits.
2019-09-16 14:04:36.124 +07:00 [WRN] No XML encryptor configured. Key "7f64df9a-8978-42fd-910b-3d41c8aa511c" may be persisted to storage in unencrypted form.
2019-09-16 14:04:37.620 +07:00 [INF] Starting IdentityServer4 version 2.5.0.0
2019-09-16 14:04:37.638 +07:00 [INF] Using the default authentication scheme idsrv for IdentityServer
2019-09-16 14:04:37.638 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for authentication
2019-09-16 14:04:37.638 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-in
2019-09-16 14:04:37.638 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-out
2019-09-16 14:04:37.638 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for challenge
2019-09-16 14:04:37.638 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for forbid
2019-09-16 14:04:37.727 +07:00 [DBG] Starting grant removal
2019-09-16 14:04:38.001 +07:00 [DBG] Login Url: /Account/Login
2019-09-16 14:04:38.003 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-09-16 14:04:38.003 +07:00 [DBG] Logout Url: /Account/Logout
2019-09-16 14:04:38.003 +07:00 [DBG] ConsentUrl Url: /consent
2019-09-16 14:04:38.003 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2019-09-16 14:04:38.003 +07:00 [DBG] Error Url: /home/error
2019-09-16 14:04:38.003 +07:00 [DBG] Error Id Parameter: errorId
2019-09-16 14:04:38.110 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:04:38.129 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:04:51.181 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:05:26.254 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-09-16 14:05:26.257 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-09-16 14:05:26.257 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-09-16 14:05:26.260 +07:00 [DBG] Start discovery request
2019-09-16 14:05:26.382 +07:00 [DBG] Found ["api1"] as all scopes in database
2019-09-16 14:05:26.503 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-09-16 14:05:26.505 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-09-16 14:05:26.505 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-09-16 14:05:26.508 +07:00 [DBG] Start authorize request
2019-09-16 14:05:26.514 +07:00 [DBG] No user present in authorize request
2019-09-16 14:05:26.519 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:05:26.635 +07:00 [DBG] mvc found in database: true
2019-09-16 14:05:26.642 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:05:26.653 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:05:26.655 +07:00 [DBG] No PKCE used.
2019-09-16 14:05:26.683 +07:00 [DBG] Found [] identity scopes in database
2019-09-16 14:05:26.783 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:05:26.786 +07:00 [ERR] Invalid scope: openid
2019-09-16 14:05:26.788 +07:00 [ERR] Request validation failed
2019-09-16 14:05:26.796 +07:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8PD0i6003bZHnSg26bBI6yva0VEwQ4hQRew2-tqozHZDZ6pvZekB_wvJ9otuM3sAJ5bT1x-2dd3k4TPvHuVHPK-HgnZ6lnadp-qr1RsffZKh6r8Y4ky54lgmd6Uactj4DxlqNk_TbL40F7vAt23DIl-PeZJhTI6j9JaW04JXD1l3BPbsqmSuTpO1-WkOhD5Sx-dhTSfUC-vIfXqNCuyeFFCtzHM83Xh37Y0Ub7k2qfvekIS9wVwUyn-0XOPaf3nWhspR73ytFed5rULJVUbRQcmBLe2XOhDlpvJdkf4T9urUwvK4qZOINRVzieMUCsXG8RfEOksydJ2073O7yzgZTC8","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042143264920203.OGRiNTU0NTYtNzdlYS00NDI2LThkZjYtY2UxNGQ1NGM2MDZlZGExMTcxMjgtNWM1Ny00NmYyLTk4NmMtOWFlYzM1MzRkNTI1","state":"CfDJ8PD0i6003bZHnSg26bBI6yva0VEwQ4hQRew2-tqozHZDZ6pvZekB_wvJ9otuM3sAJ5bT1x-2dd3k4TPvHuVHPK-HgnZ6lnadp-qr1RsffZKh6r8Y4ky54lgmd6Uactj4DxlqNk_TbL40F7vAt23DIl-PeZJhTI6j9JaW04JXD1l3BPbsqmSuTpO1-WkOhD5Sx-dhTSfUC-vIfXqNCuyeFFCtzHM83Xh37Y0Ub7k2qfvekIS9wVwUyn-0XOPaf3nWhspR73ytFed5rULJVUbRQcmBLe2XOhDlpvJdkf4T9urUwvK4qZOINRVzieMUCsXG8RfEOksydJ2073O7yzgZTC8","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:05:43.389 +07:00 [DBG] Stopping grant removal
2019-09-16 14:05:43.390 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 14:05:56.978 +07:00 [WRN] Using an in-memory repository. Keys will not be persisted to storage.
2019-09-16 14:05:56.998 +07:00 [WRN] Neither user profile nor HKLM registry available. Using an ephemeral key repository. Protected data will be unavailable when application exits.
2019-09-16 14:05:57.010 +07:00 [WRN] No XML encryptor configured. Key "fe7a40d9-376d-4fcc-8612-0b6e16d1ff94" may be persisted to storage in unencrypted form.
2019-09-16 14:05:58.400 +07:00 [INF] Starting IdentityServer4 version 2.5.0.0
2019-09-16 14:05:58.417 +07:00 [INF] Using the default authentication scheme idsrv for IdentityServer
2019-09-16 14:05:58.417 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for authentication
2019-09-16 14:05:58.417 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-in
2019-09-16 14:05:58.417 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-out
2019-09-16 14:05:58.417 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for challenge
2019-09-16 14:05:58.417 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for forbid
2019-09-16 14:05:58.511 +07:00 [DBG] Starting grant removal
2019-09-16 14:05:58.704 +07:00 [DBG] Login Url: /Account/Login
2019-09-16 14:05:58.706 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-09-16 14:05:58.706 +07:00 [DBG] Logout Url: /Account/Logout
2019-09-16 14:05:58.706 +07:00 [DBG] ConsentUrl Url: /consent
2019-09-16 14:05:58.706 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2019-09-16 14:05:58.706 +07:00 [DBG] Error Url: /home/error
2019-09-16 14:05:58.706 +07:00 [DBG] Error Id Parameter: errorId
2019-09-16 14:05:58.729 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-09-16 14:05:58.739 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-09-16 14:05:58.739 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-09-16 14:05:58.742 +07:00 [DBG] Start authorize request
2019-09-16 14:05:58.751 +07:00 [DBG] No user present in authorize request
2019-09-16 14:05:58.755 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:05:58.872 +07:00 [DBG] mvc found in database: true
2019-09-16 14:05:58.879 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:05:58.890 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:05:58.891 +07:00 [DBG] No PKCE used.
2019-09-16 14:05:58.937 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:05:59.087 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:05:59.100 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:05:59.102 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:05:59.110 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:05:59.119 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8PD0i6003bZHnSg26bBI6yt6rEF_cThfMN7w_iQbbMUtdjzLhOap86nQxjry2d7PT_z_dw7mdxCuW_5UwMxXaN8krFLs7B9Wj01ECYG74i7kmCRaJ1UJk9aa4EIlJOdgYKrcRt6t9VkDuh8ZOmAv5BJ6O6x2xnwXRkTLcsWIygmPGwDav1QQhnru42_3Nlg9KMMJsERd9w1L1f85wSaFjY-G1X3uazQhCPFmLi8CM_AwwDEc_B-y4qWUJYyYeobtUgGQ3XF1GpZ6DEpB9SsVmpbU15GWckaeG-lNHzMBTuEBtgMz_7V4w0JuAjMLIlQwHtjDniHKID8cHGH6wUL3-ms","UiLocales":null,"Nonce":"637042143566032808.ZmYzYmM1YjMtODQ2MC00MDgyLTgyZTQtY2ExOGZiYzRhNDY3NzE1YTgyYmEtZjE0MS00OWJlLWFkYmYtYTdiNDI4ZjNmOWZm","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042143566032808.ZmYzYmM1YjMtODQ2MC00MDgyLTgyZTQtY2ExOGZiYzRhNDY3NzE1YTgyYmEtZjE0MS00OWJlLWFkYmYtYTdiNDI4ZjNmOWZm","state":"CfDJ8PD0i6003bZHnSg26bBI6yt6rEF_cThfMN7w_iQbbMUtdjzLhOap86nQxjry2d7PT_z_dw7mdxCuW_5UwMxXaN8krFLs7B9Wj01ECYG74i7kmCRaJ1UJk9aa4EIlJOdgYKrcRt6t9VkDuh8ZOmAv5BJ6O6x2xnwXRkTLcsWIygmPGwDav1QQhnru42_3Nlg9KMMJsERd9w1L1f85wSaFjY-G1X3uazQhCPFmLi8CM_AwwDEc_B-y4qWUJYyYeobtUgGQ3XF1GpZ6DEpB9SsVmpbU15GWckaeG-lNHzMBTuEBtgMz_7V4w0JuAjMLIlQwHtjDniHKID8cHGH6wUL3-ms","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:05:59.130 +07:00 [INF] Showing login: User is not authenticated
2019-09-16 14:05:59.259 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:05:59.263 +07:00 [DBG] mvc found in database: true
2019-09-16 14:05:59.263 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:05:59.263 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:05:59.263 +07:00 [DBG] No PKCE used.
2019-09-16 14:05:59.264 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:05:59.266 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:05:59.267 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:05:59.269 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:05:59.269 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:05:59.273 +07:00 [DBG] mvc found in database: true
2019-09-16 14:05:59.273 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:05:59.326 +07:00 [ERR] An exception was thrown while deserializing the token.
Microsoft.AspNetCore.Antiforgery.AntiforgeryValidationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {7f64df9a-8978-42fd-910b-3d41c8aa511c} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2019-09-16 14:06:39.445 +07:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-09-16 14:06:39.484 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:06:39.488 +07:00 [DBG] mvc found in database: true
2019-09-16 14:06:39.488 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:06:39.489 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:06:39.489 +07:00 [DBG] No PKCE used.
2019-09-16 14:06:39.492 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:06:39.494 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:06:39.495 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:06:39.496 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:06:39.496 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:06:39.512 +07:00 [DBG] Augmenting SignInContext
2019-09-16 14:06:39.514 +07:00 [DBG] Adding idp claim with value: local
2019-09-16 14:06:39.514 +07:00 [DBG] Adding amr claim with value: pwd
2019-09-16 14:06:39.523 +07:00 [INF] AuthenticationScheme: idsrv signed in.
2019-09-16 14:06:39.526 +07:00 [DBG] mvc found in database: true
2019-09-16 14:06:39.526 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:06:39.530 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-09-16 14:06:39.531 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-09-16 14:06:39.531 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-09-16 14:06:39.537 +07:00 [DBG] Start authorize callback request
2019-09-16 14:06:39.540 +07:00 [DBG] User in authorize request: 2
2019-09-16 14:06:39.540 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:06:39.542 +07:00 [DBG] mvc found in database: true
2019-09-16 14:06:39.543 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:06:39.543 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:06:39.543 +07:00 [DBG] No PKCE used.
2019-09-16 14:06:39.544 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:06:39.545 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:06:39.546 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:06:39.548 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:06:39.548 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:06:39.548 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8PD0i6003bZHnSg26bBI6yt6rEF_cThfMN7w_iQbbMUtdjzLhOap86nQxjry2d7PT_z_dw7mdxCuW_5UwMxXaN8krFLs7B9Wj01ECYG74i7kmCRaJ1UJk9aa4EIlJOdgYKrcRt6t9VkDuh8ZOmAv5BJ6O6x2xnwXRkTLcsWIygmPGwDav1QQhnru42_3Nlg9KMMJsERd9w1L1f85wSaFjY-G1X3uazQhCPFmLi8CM_AwwDEc_B-y4qWUJYyYeobtUgGQ3XF1GpZ6DEpB9SsVmpbU15GWckaeG-lNHzMBTuEBtgMz_7V4w0JuAjMLIlQwHtjDniHKID8cHGH6wUL3-ms","UiLocales":null,"Nonce":"637042143566032808.ZmYzYmM1YjMtODQ2MC00MDgyLTgyZTQtY2ExOGZiYzRhNDY3NzE1YTgyYmEtZjE0MS00OWJlLWFkYmYtYTdiNDI4ZjNmOWZm","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"5a150a66fc64db51f29404a98746b563","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042143566032808.ZmYzYmM1YjMtODQ2MC00MDgyLTgyZTQtY2ExOGZiYzRhNDY3NzE1YTgyYmEtZjE0MS00OWJlLWFkYmYtYTdiNDI4ZjNmOWZm","state":"CfDJ8PD0i6003bZHnSg26bBI6yt6rEF_cThfMN7w_iQbbMUtdjzLhOap86nQxjry2d7PT_z_dw7mdxCuW_5UwMxXaN8krFLs7B9Wj01ECYG74i7kmCRaJ1UJk9aa4EIlJOdgYKrcRt6t9VkDuh8ZOmAv5BJ6O6x2xnwXRkTLcsWIygmPGwDav1QQhnru42_3Nlg9KMMJsERd9w1L1f85wSaFjY-G1X3uazQhCPFmLi8CM_AwwDEc_B-y4qWUJYyYeobtUgGQ3XF1GpZ6DEpB9SsVmpbU15GWckaeG-lNHzMBTuEBtgMz_7V4w0JuAjMLIlQwHtjDniHKID8cHGH6wUL3-ms","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:06:39.549 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 14:06:39.558 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 14:06:39.558 +07:00 [INF] Showing consent: User has not yet consented
2019-09-16 14:06:39.576 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:06:39.579 +07:00 [DBG] mvc found in database: true
2019-09-16 14:06:39.579 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:06:39.579 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:06:39.579 +07:00 [DBG] No PKCE used.
2019-09-16 14:06:39.580 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:06:39.582 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:06:39.583 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:06:39.584 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:06:39.584 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:06:39.586 +07:00 [DBG] mvc found in database: true
2019-09-16 14:06:39.586 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:06:39.592 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:06:39.653 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:06:41.909 +07:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-09-16 14:06:41.924 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:06:41.928 +07:00 [DBG] mvc found in database: true
2019-09-16 14:06:41.928 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:06:41.928 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:06:41.928 +07:00 [DBG] No PKCE used.
2019-09-16 14:06:41.929 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:06:41.931 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:06:41.932 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:06:41.934 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:06:41.934 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:06:41.981 +07:00 [DBG] mvc found in database: true
2019-09-16 14:06:41.981 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:06:41.984 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-09-16 14:06:41.985 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-09-16 14:06:41.985 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-09-16 14:06:41.986 +07:00 [DBG] Start authorize callback request
2019-09-16 14:06:41.989 +07:00 [DBG] User in authorize request: 2
2019-09-16 14:06:41.989 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:06:41.993 +07:00 [DBG] mvc found in database: true
2019-09-16 14:06:41.993 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:06:41.993 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:06:41.993 +07:00 [DBG] No PKCE used.
2019-09-16 14:06:41.994 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:06:41.997 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:06:41.998 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:06:42.000 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:06:42.000 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:06:42.000 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8PD0i6003bZHnSg26bBI6yt6rEF_cThfMN7w_iQbbMUtdjzLhOap86nQxjry2d7PT_z_dw7mdxCuW_5UwMxXaN8krFLs7B9Wj01ECYG74i7kmCRaJ1UJk9aa4EIlJOdgYKrcRt6t9VkDuh8ZOmAv5BJ6O6x2xnwXRkTLcsWIygmPGwDav1QQhnru42_3Nlg9KMMJsERd9w1L1f85wSaFjY-G1X3uazQhCPFmLi8CM_AwwDEc_B-y4qWUJYyYeobtUgGQ3XF1GpZ6DEpB9SsVmpbU15GWckaeG-lNHzMBTuEBtgMz_7V4w0JuAjMLIlQwHtjDniHKID8cHGH6wUL3-ms","UiLocales":null,"Nonce":"637042143566032808.ZmYzYmM1YjMtODQ2MC00MDgyLTgyZTQtY2ExOGZiYzRhNDY3NzE1YTgyYmEtZjE0MS00OWJlLWFkYmYtYTdiNDI4ZjNmOWZm","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"5a150a66fc64db51f29404a98746b563","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042143566032808.ZmYzYmM1YjMtODQ2MC00MDgyLTgyZTQtY2ExOGZiYzRhNDY3NzE1YTgyYmEtZjE0MS00OWJlLWFkYmYtYTdiNDI4ZjNmOWZm","state":"CfDJ8PD0i6003bZHnSg26bBI6yt6rEF_cThfMN7w_iQbbMUtdjzLhOap86nQxjry2d7PT_z_dw7mdxCuW_5UwMxXaN8krFLs7B9Wj01ECYG74i7kmCRaJ1UJk9aa4EIlJOdgYKrcRt6t9VkDuh8ZOmAv5BJ6O6x2xnwXRkTLcsWIygmPGwDav1QQhnru42_3Nlg9KMMJsERd9w1L1f85wSaFjY-G1X3uazQhCPFmLi8CM_AwwDEc_B-y4qWUJYyYeobtUgGQ3XF1GpZ6DEpB9SsVmpbU15GWckaeG-lNHzMBTuEBtgMz_7V4w0JuAjMLIlQwHtjDniHKID8cHGH6wUL3-ms","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:06:42.000 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 14:06:42.000 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 14:06:42.004 +07:00 [INF] User consented to scopes: ["profile","openid","api1","offline_access"]
2019-09-16 14:06:42.005 +07:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2019-09-16 14:06:42.008 +07:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 2
2019-09-16 14:06:42.031 +07:00 [DBG] QIM5q/EfBaHTA6V377/X6CDksjn7Imin78ZZLT1RY0E= found in database
2019-09-16 14:06:42.050 +07:00 [DBG] Creating Hybrid Flow response.
2019-09-16 14:06:42.067 +07:00 [DBG] qtJSF6IK9YPVagQevdhq1+ylOtd5hno78joLDWts4Kk= not found in database
2019-09-16 14:06:42.072 +07:00 [DBG] Creating Implicit Flow response.
2019-09-16 14:06:42.080 +07:00 [DBG] Getting claims for identity token for subject: 2 and client: mvc
2019-09-16 14:06:42.082 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-09-16 14:06:42.095 +07:00 [FTL] Unhandled exception: No signing credential is configured. Can't create JWT token
System.InvalidOperationException: No signing credential is configured. Can't create JWT token
   at IdentityServer4.Services.DefaultTokenCreationService.CreateHeaderAsync(Token token)
   at IdentityServer4.Services.DefaultTokenCreationService.CreateTokenAsync(Token token)
   at IdentityServer4.Services.DefaultTokenService.CreateSecurityTokenAsync(Token token)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateImplicitFlowResponseAsync(ValidatedAuthorizeRequest request, String authorizationCode)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateHybridFlowResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.Endpoints.AuthorizeEndpointBase.ProcessAuthorizeRequestAsync(NameValueCollection parameters, ClaimsPrincipal user, ConsentResponse consent)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events)
2019-09-16 14:06:42.096 +07:00 [ERR] Connection id "0HLPQEH9MJA72", Request id "0HLPQEH9MJA72:00000008": An unhandled exception was thrown by the application.
System.InvalidOperationException: No signing credential is configured. Can't create JWT token
   at IdentityServer4.Services.DefaultTokenCreationService.CreateHeaderAsync(Token token)
   at IdentityServer4.Services.DefaultTokenCreationService.CreateTokenAsync(Token token)
   at IdentityServer4.Services.DefaultTokenService.CreateSecurityTokenAsync(Token token)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateImplicitFlowResponseAsync(ValidatedAuthorizeRequest request, String authorizationCode)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateHybridFlowResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.Endpoints.AuthorizeEndpointBase.ProcessAuthorizeRequestAsync(NameValueCollection parameters, ClaimsPrincipal user, ConsentResponse consent)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events)
   at IdentityServer4.Hosting.MutualTlsTokenEndpointMiddleware.Invoke(HttpContext context, IAuthenticationSchemeProvider schemes)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at IdentityServer4.Hosting.BaseUrlMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.IISIntegration.IISMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2019-09-16 14:10:24.502 +07:00 [DBG] Stopping grant removal
2019-09-16 14:10:24.502 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 14:10:36.903 +07:00 [WRN] Using an in-memory repository. Keys will not be persisted to storage.
2019-09-16 14:10:36.923 +07:00 [WRN] Neither user profile nor HKLM registry available. Using an ephemeral key repository. Protected data will be unavailable when application exits.
2019-09-16 14:10:36.935 +07:00 [WRN] No XML encryptor configured. Key "edf29db0-bcc3-4dc3-86e7-c1f0a0e3826b" may be persisted to storage in unencrypted form.
2019-09-16 14:10:38.270 +07:00 [INF] Starting IdentityServer4 version 2.5.0.0
2019-09-16 14:10:38.286 +07:00 [INF] Using the default authentication scheme idsrv for IdentityServer
2019-09-16 14:10:38.286 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for authentication
2019-09-16 14:10:38.287 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-in
2019-09-16 14:10:38.287 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-out
2019-09-16 14:10:38.287 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for challenge
2019-09-16 14:10:38.287 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for forbid
2019-09-16 14:10:38.372 +07:00 [DBG] Starting grant removal
2019-09-16 14:10:38.643 +07:00 [DBG] Login Url: /Account/Login
2019-09-16 14:10:38.645 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-09-16 14:10:38.645 +07:00 [DBG] Logout Url: /Account/Logout
2019-09-16 14:10:38.645 +07:00 [DBG] ConsentUrl Url: /consent
2019-09-16 14:10:38.645 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2019-09-16 14:10:38.645 +07:00 [DBG] Error Url: /home/error
2019-09-16 14:10:38.645 +07:00 [DBG] Error Id Parameter: errorId
2019-09-16 14:10:38.650 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:10:38.664 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:10:38.670 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-09-16 14:10:38.679 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-09-16 14:10:38.680 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-09-16 14:10:38.683 +07:00 [DBG] Start authorize request
2019-09-16 14:10:38.686 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:10:38.690 +07:00 [DBG] No user present in authorize request
2019-09-16 14:10:38.694 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:10:38.811 +07:00 [DBG] mvc found in database: true
2019-09-16 14:10:38.819 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:10:38.830 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:10:38.831 +07:00 [DBG] No PKCE used.
2019-09-16 14:10:38.867 +07:00 [DBG] Found [] identity scopes in database
2019-09-16 14:10:39.004 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:10:39.014 +07:00 [ERR] Invalid scope: openid
2019-09-16 14:10:39.016 +07:00 [ERR] Request validation failed
2019-09-16 14:10:39.024 +07:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8PD0i6003bZHnSg26bBI6yuhkhVN0UpzABbBlXUEe9bdbghaZzhx4Jh03ecfa3trHL38pA4QLh4u-wng_IurCsEcGgFddrLhB8DqdsTF5komdbPprLPomgEDhIie-Ta95Htx995yVntf5WSoIYoyPs5U9ShKDzwWglQQiPQIbiN2ksn9CC4gB7mdO_97aMp-X2JU2bBvvKs7f2GeqKPOHvqeaZwRnj89s60hK4y1NgI0WejzBPCH-1W6gIwPQDaINYi-IJ2khWC5uTu-0c1nrj9iSQ4q6OUioLSkcOIhXTQG-dNTtVJBcbLPG4lTe_yvvIAgyLwVpZiSZqlq094tlvA","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042146365301821.MmEwZDMyMzItYWM2ZC00MzYyLTk0NzItYjFiNmMwZWM0NjYxYWVlMTNhZDEtYmFlNi00YzU2LWExZjQtZDUzYzM0MjlhNGNl","state":"CfDJ8PD0i6003bZHnSg26bBI6yuhkhVN0UpzABbBlXUEe9bdbghaZzhx4Jh03ecfa3trHL38pA4QLh4u-wng_IurCsEcGgFddrLhB8DqdsTF5komdbPprLPomgEDhIie-Ta95Htx995yVntf5WSoIYoyPs5U9ShKDzwWglQQiPQIbiN2ksn9CC4gB7mdO_97aMp-X2JU2bBvvKs7f2GeqKPOHvqeaZwRnj89s60hK4y1NgI0WejzBPCH-1W6gIwPQDaINYi-IJ2khWC5uTu-0c1nrj9iSQ4q6OUioLSkcOIhXTQG-dNTtVJBcbLPG4lTe_yvvIAgyLwVpZiSZqlq094tlvA","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:10:39.086 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:10:39.086 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:10:50.872 +07:00 [DBG] Stopping grant removal
2019-09-16 14:10:50.873 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 14:11:44.005 +07:00 [WRN] Using an in-memory repository. Keys will not be persisted to storage.
2019-09-16 14:11:44.028 +07:00 [WRN] Neither user profile nor HKLM registry available. Using an ephemeral key repository. Protected data will be unavailable when application exits.
2019-09-16 14:11:44.042 +07:00 [WRN] No XML encryptor configured. Key "74ec3aef-2f10-4a3e-a0cc-5335eb88dcab" may be persisted to storage in unencrypted form.
2019-09-16 14:11:45.487 +07:00 [INF] Starting IdentityServer4 version 2.5.0.0
2019-09-16 14:11:45.504 +07:00 [INF] Using the default authentication scheme idsrv for IdentityServer
2019-09-16 14:11:45.504 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for authentication
2019-09-16 14:11:45.504 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-in
2019-09-16 14:11:45.504 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-out
2019-09-16 14:11:45.504 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for challenge
2019-09-16 14:11:45.504 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for forbid
2019-09-16 14:11:45.591 +07:00 [DBG] Starting grant removal
2019-09-16 14:11:45.697 +07:00 [DBG] Login Url: /Account/Login
2019-09-16 14:11:45.699 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-09-16 14:11:45.699 +07:00 [DBG] Logout Url: /Account/Logout
2019-09-16 14:11:45.699 +07:00 [DBG] ConsentUrl Url: /consent
2019-09-16 14:11:45.699 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2019-09-16 14:11:45.699 +07:00 [DBG] Error Url: /home/error
2019-09-16 14:11:45.700 +07:00 [DBG] Error Id Parameter: errorId
2019-09-16 14:11:45.706 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:11:45.721 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:11:45.805 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:11:47.525 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:11:47.525 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:11:47.529 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:11:52.948 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:11:52.948 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:11:53.046 +07:00 [ERR] An exception was thrown while deserializing the token.
Microsoft.AspNetCore.Antiforgery.AntiforgeryValidationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {fe7a40d9-376d-4fcc-8612-0b6e16d1ff94} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2019-09-16 14:11:57.518 +07:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-09-16 14:11:57.519 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:11:57.520 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:11:57.573 +07:00 [DBG] Augmenting SignInContext
2019-09-16 14:11:57.574 +07:00 [DBG] Adding idp claim with value: local
2019-09-16 14:11:57.574 +07:00 [DBG] Adding amr claim with value: pwd
2019-09-16 14:11:57.578 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:11:57.583 +07:00 [INF] AuthenticationScheme: idsrv signed in.
2019-09-16 14:11:57.589 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:11:59.905 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:12:00.464 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:12:00.636 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:12:00.797 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:12:00.945 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 14:12:14.062 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-09-16 14:12:14.067 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-09-16 14:12:14.067 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-09-16 14:12:14.070 +07:00 [DBG] Start authorize request
2019-09-16 14:12:14.075 +07:00 [DBG] User in authorize request: 2
2019-09-16 14:12:14.080 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:12:14.200 +07:00 [DBG] mvc found in database: true
2019-09-16 14:12:14.207 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:12:14.218 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:12:14.219 +07:00 [DBG] No PKCE used.
2019-09-16 14:12:14.265 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:12:14.416 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:12:14.429 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:12:14.431 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:12:14.439 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:12:14.449 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8PD0i6003bZHnSg26bBI6ytdp8B_-FwABO80XuPNGsBt2_-SlhW431jE4FadMOzFRnkT5sCyqesXqkaIwxWSa8hPpBY3DggpO3IN0ZWE96iQ2K5PlrcxvWSt3dl3lKxle9bTm37Y3CJjyxBg1VvqX-BB3xWWoowMvy_p2yhlxwZiz6Rxaq9xXaxwh2KCZGQf1gPX6kN_HY4Fb-qoHoRK14jbYUgrIKwK234QbYzdRaUNMx0611uaBHk53mnmPFT2GqPl89Gm33oykscTkqN9QT82dLmUwM0GegtawpqlF2po4x3Xgn2F0q01an-2bYmPYBIK6nGI0nJ1oBtRyGOHYN4","UiLocales":null,"Nonce":"637042147340569577.ZjhjM2RlZDAtYmFlZC00MWRlLTg2MmQtNTFlOWRlYzc3MWE4NzVkZjI4MzItYjIyNi00N2VkLTkyZGItY2EwMWNjYjE0ZWJi","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"5b5880e2ef55901e0f959875630021d1","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042147340569577.ZjhjM2RlZDAtYmFlZC00MWRlLTg2MmQtNTFlOWRlYzc3MWE4NzVkZjI4MzItYjIyNi00N2VkLTkyZGItY2EwMWNjYjE0ZWJi","state":"CfDJ8PD0i6003bZHnSg26bBI6ytdp8B_-FwABO80XuPNGsBt2_-SlhW431jE4FadMOzFRnkT5sCyqesXqkaIwxWSa8hPpBY3DggpO3IN0ZWE96iQ2K5PlrcxvWSt3dl3lKxle9bTm37Y3CJjyxBg1VvqX-BB3xWWoowMvy_p2yhlxwZiz6Rxaq9xXaxwh2KCZGQf1gPX6kN_HY4Fb-qoHoRK14jbYUgrIKwK234QbYzdRaUNMx0611uaBHk53mnmPFT2GqPl89Gm33oykscTkqN9QT82dLmUwM0GegtawpqlF2po4x3Xgn2F0q01an-2bYmPYBIK6nGI0nJ1oBtRyGOHYN4","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:12:14.460 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 14:12:14.468 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 14:12:14.468 +07:00 [INF] Showing consent: User has not yet consented
2019-09-16 14:12:14.490 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:12:14.493 +07:00 [DBG] mvc found in database: true
2019-09-16 14:12:14.493 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:12:14.493 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:12:14.493 +07:00 [DBG] No PKCE used.
2019-09-16 14:12:14.494 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:12:14.496 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:12:14.497 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:12:14.499 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:12:14.499 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:12:14.502 +07:00 [DBG] mvc found in database: true
2019-09-16 14:12:14.502 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:12:14.507 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:12:14.571 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:12:16.420 +07:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-09-16 14:12:16.435 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:12:16.439 +07:00 [DBG] mvc found in database: true
2019-09-16 14:12:16.439 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:12:16.439 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:12:16.439 +07:00 [DBG] No PKCE used.
2019-09-16 14:12:16.440 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:12:16.443 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:12:16.444 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:12:16.446 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:12:16.446 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:12:16.458 +07:00 [ERR] Error unprotecting message cookie
System.Security.Cryptography.CryptographicException: The key {4e3c7089-cf03-4f86-a9f4-d06f378b6206} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.DataProtection.DataProtectionCommonExtensions.Unprotect(IDataProtector protector, String protectedData)
   at IdentityServer4.MessageCookie`1.Unprotect(String data)
   at IdentityServer4.MessageCookie`1.ReadByCookieName(String name)
2019-09-16 14:12:16.461 +07:00 [ERR] Error unprotecting message cookie
System.Security.Cryptography.CryptographicException: The key {fe7a40d9-376d-4fcc-8612-0b6e16d1ff94} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.DataProtection.DataProtectionCommonExtensions.Unprotect(IDataProtector protector, String protectedData)
   at IdentityServer4.MessageCookie`1.Unprotect(String data)
   at IdentityServer4.MessageCookie`1.ReadByCookieName(String name)
2019-09-16 14:12:16.499 +07:00 [DBG] mvc found in database: true
2019-09-16 14:12:16.499 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:12:16.502 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-09-16 14:12:16.503 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-09-16 14:12:16.504 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-09-16 14:12:16.510 +07:00 [DBG] Start authorize callback request
2019-09-16 14:12:16.514 +07:00 [DBG] User in authorize request: 2
2019-09-16 14:12:16.514 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:12:16.517 +07:00 [DBG] mvc found in database: true
2019-09-16 14:12:16.517 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:12:16.518 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:12:16.518 +07:00 [DBG] No PKCE used.
2019-09-16 14:12:16.519 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:12:16.521 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:12:16.522 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:12:16.524 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:12:16.524 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:12:16.524 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8PD0i6003bZHnSg26bBI6ytdp8B_-FwABO80XuPNGsBt2_-SlhW431jE4FadMOzFRnkT5sCyqesXqkaIwxWSa8hPpBY3DggpO3IN0ZWE96iQ2K5PlrcxvWSt3dl3lKxle9bTm37Y3CJjyxBg1VvqX-BB3xWWoowMvy_p2yhlxwZiz6Rxaq9xXaxwh2KCZGQf1gPX6kN_HY4Fb-qoHoRK14jbYUgrIKwK234QbYzdRaUNMx0611uaBHk53mnmPFT2GqPl89Gm33oykscTkqN9QT82dLmUwM0GegtawpqlF2po4x3Xgn2F0q01an-2bYmPYBIK6nGI0nJ1oBtRyGOHYN4","UiLocales":null,"Nonce":"637042147340569577.ZjhjM2RlZDAtYmFlZC00MWRlLTg2MmQtNTFlOWRlYzc3MWE4NzVkZjI4MzItYjIyNi00N2VkLTkyZGItY2EwMWNjYjE0ZWJi","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"5b5880e2ef55901e0f959875630021d1","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042147340569577.ZjhjM2RlZDAtYmFlZC00MWRlLTg2MmQtNTFlOWRlYzc3MWE4NzVkZjI4MzItYjIyNi00N2VkLTkyZGItY2EwMWNjYjE0ZWJi","state":"CfDJ8PD0i6003bZHnSg26bBI6ytdp8B_-FwABO80XuPNGsBt2_-SlhW431jE4FadMOzFRnkT5sCyqesXqkaIwxWSa8hPpBY3DggpO3IN0ZWE96iQ2K5PlrcxvWSt3dl3lKxle9bTm37Y3CJjyxBg1VvqX-BB3xWWoowMvy_p2yhlxwZiz6Rxaq9xXaxwh2KCZGQf1gPX6kN_HY4Fb-qoHoRK14jbYUgrIKwK234QbYzdRaUNMx0611uaBHk53mnmPFT2GqPl89Gm33oykscTkqN9QT82dLmUwM0GegtawpqlF2po4x3Xgn2F0q01an-2bYmPYBIK6nGI0nJ1oBtRyGOHYN4","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:12:16.526 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 14:12:16.526 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 14:12:16.530 +07:00 [INF] User consented to scopes: ["profile","openid","api1","offline_access"]
2019-09-16 14:12:16.531 +07:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2019-09-16 14:12:16.534 +07:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 2
2019-09-16 14:12:16.556 +07:00 [DBG] QIM5q/EfBaHTA6V377/X6CDksjn7Imin78ZZLT1RY0E= found in database
2019-09-16 14:12:16.575 +07:00 [DBG] Creating Hybrid Flow response.
2019-09-16 14:12:16.589 +07:00 [DBG] ft5hCOxEFvyM3gWmmP59TPN9tBkGinrM65SVsZFcPgI= not found in database
2019-09-16 14:12:16.595 +07:00 [DBG] Creating Implicit Flow response.
2019-09-16 14:12:16.603 +07:00 [DBG] Getting claims for identity token for subject: 2 and client: mvc
2019-09-16 14:12:16.604 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-09-16 14:12:16.617 +07:00 [FTL] Unhandled exception: No signing credential is configured. Can't create JWT token
System.InvalidOperationException: No signing credential is configured. Can't create JWT token
   at IdentityServer4.Services.DefaultTokenCreationService.CreateHeaderAsync(Token token)
   at IdentityServer4.Services.DefaultTokenCreationService.CreateTokenAsync(Token token)
   at IdentityServer4.Services.DefaultTokenService.CreateSecurityTokenAsync(Token token)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateImplicitFlowResponseAsync(ValidatedAuthorizeRequest request, String authorizationCode)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateHybridFlowResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.Endpoints.AuthorizeEndpointBase.ProcessAuthorizeRequestAsync(NameValueCollection parameters, ClaimsPrincipal user, ConsentResponse consent)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events)
2019-09-16 14:12:16.618 +07:00 [ERR] Connection id "0HLPQEKH3P15Q", Request id "0HLPQEKH3P15Q:0000000E": An unhandled exception was thrown by the application.
System.InvalidOperationException: No signing credential is configured. Can't create JWT token
   at IdentityServer4.Services.DefaultTokenCreationService.CreateHeaderAsync(Token token)
   at IdentityServer4.Services.DefaultTokenCreationService.CreateTokenAsync(Token token)
   at IdentityServer4.Services.DefaultTokenService.CreateSecurityTokenAsync(Token token)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateImplicitFlowResponseAsync(ValidatedAuthorizeRequest request, String authorizationCode)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateHybridFlowResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.Endpoints.AuthorizeEndpointBase.ProcessAuthorizeRequestAsync(NameValueCollection parameters, ClaimsPrincipal user, ConsentResponse consent)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events)
   at IdentityServer4.Hosting.MutualTlsTokenEndpointMiddleware.Invoke(HttpContext context, IAuthenticationSchemeProvider schemes)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at IdentityServer4.Hosting.BaseUrlMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.IISIntegration.IISMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2019-09-16 14:32:48.341 +07:00 [DBG] Stopping grant removal
2019-09-16 14:32:48.343 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 14:34:11.299 +07:00 [WRN] Using an in-memory repository. Keys will not be persisted to storage.
2019-09-16 14:34:11.320 +07:00 [WRN] Neither user profile nor HKLM registry available. Using an ephemeral key repository. Protected data will be unavailable when application exits.
2019-09-16 14:34:11.332 +07:00 [WRN] No XML encryptor configured. Key "3814f72e-773b-424e-a3db-e901d1c80e39" may be persisted to storage in unencrypted form.
2019-09-16 14:34:12.802 +07:00 [INF] Starting IdentityServer4 version 2.5.0.0
2019-09-16 14:34:12.818 +07:00 [INF] Using the default authentication scheme idsrv for IdentityServer
2019-09-16 14:34:12.819 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for authentication
2019-09-16 14:34:12.819 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-in
2019-09-16 14:34:12.819 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-out
2019-09-16 14:34:12.819 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for challenge
2019-09-16 14:34:12.819 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for forbid
2019-09-16 14:34:13.001 +07:00 [DBG] Starting grant removal
2019-09-16 14:34:13.313 +07:00 [DBG] Login Url: /Account/Login
2019-09-16 14:34:13.315 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-09-16 14:34:13.315 +07:00 [DBG] Logout Url: /Account/Logout
2019-09-16 14:34:13.315 +07:00 [DBG] ConsentUrl Url: /consent
2019-09-16 14:34:13.315 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2019-09-16 14:34:13.315 +07:00 [DBG] Error Url: /home/error
2019-09-16 14:34:13.315 +07:00 [DBG] Error Id Parameter: errorId
2019-09-16 14:34:13.321 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:13.335 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:13.340 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-09-16 14:34:13.351 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-09-16 14:34:13.351 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-09-16 14:34:13.356 +07:00 [DBG] Start authorize callback request
2019-09-16 14:34:13.360 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:13.367 +07:00 [DBG] No user present in authorize request
2019-09-16 14:34:13.372 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:34:13.491 +07:00 [DBG] mvc found in database: true
2019-09-16 14:34:13.499 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:34:13.509 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:34:13.510 +07:00 [DBG] No PKCE used.
2019-09-16 14:34:13.590 +07:00 [DBG] Found [] identity scopes in database
2019-09-16 14:34:13.781 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:34:13.791 +07:00 [ERR] Invalid scope: openid
2019-09-16 14:34:13.794 +07:00 [ERR] Request validation failed
2019-09-16 14:34:13.804 +07:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8PD0i6003bZHnSg26bBI6ytdp8B_-FwABO80XuPNGsBt2_-SlhW431jE4FadMOzFRnkT5sCyqesXqkaIwxWSa8hPpBY3DggpO3IN0ZWE96iQ2K5PlrcxvWSt3dl3lKxle9bTm37Y3CJjyxBg1VvqX-BB3xWWoowMvy_p2yhlxwZiz6Rxaq9xXaxwh2KCZGQf1gPX6kN_HY4Fb-qoHoRK14jbYUgrIKwK234QbYzdRaUNMx0611uaBHk53mnmPFT2GqPl89Gm33oykscTkqN9QT82dLmUwM0GegtawpqlF2po4x3Xgn2F0q01an-2bYmPYBIK6nGI0nJ1oBtRyGOHYN4","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042147340569577.ZjhjM2RlZDAtYmFlZC00MWRlLTg2MmQtNTFlOWRlYzc3MWE4NzVkZjI4MzItYjIyNi00N2VkLTkyZGItY2EwMWNjYjE0ZWJi","state":"CfDJ8PD0i6003bZHnSg26bBI6ytdp8B_-FwABO80XuPNGsBt2_-SlhW431jE4FadMOzFRnkT5sCyqesXqkaIwxWSa8hPpBY3DggpO3IN0ZWE96iQ2K5PlrcxvWSt3dl3lKxle9bTm37Y3CJjyxBg1VvqX-BB3xWWoowMvy_p2yhlxwZiz6Rxaq9xXaxwh2KCZGQf1gPX6kN_HY4Fb-qoHoRK14jbYUgrIKwK234QbYzdRaUNMx0611uaBHk53mnmPFT2GqPl89Gm33oykscTkqN9QT82dLmUwM0GegtawpqlF2po4x3Xgn2F0q01an-2bYmPYBIK6nGI0nJ1oBtRyGOHYN4","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:34:13.877 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:13.877 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:19.534 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:19.535 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:20.205 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:20.206 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:20.430 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:20.430 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:20.623 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:20.624 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:20.798 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:20.798 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:20.958 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:20.958 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:49.183 +07:00 [DBG] Stopping grant removal
2019-09-16 14:34:49.184 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 14:34:52.776 +07:00 [WRN] Using an in-memory repository. Keys will not be persisted to storage.
2019-09-16 14:34:52.797 +07:00 [WRN] Neither user profile nor HKLM registry available. Using an ephemeral key repository. Protected data will be unavailable when application exits.
2019-09-16 14:34:52.810 +07:00 [WRN] No XML encryptor configured. Key "87b55cc9-0414-4879-b09f-45d25b2feb63" may be persisted to storage in unencrypted form.
2019-09-16 14:34:54.159 +07:00 [INF] Starting IdentityServer4 version 2.5.0.0
2019-09-16 14:34:54.174 +07:00 [INF] Using the default authentication scheme idsrv for IdentityServer
2019-09-16 14:34:54.174 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for authentication
2019-09-16 14:34:54.174 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-in
2019-09-16 14:34:54.175 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-out
2019-09-16 14:34:54.175 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for challenge
2019-09-16 14:34:54.175 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for forbid
2019-09-16 14:34:54.258 +07:00 [DBG] Starting grant removal
2019-09-16 14:34:54.527 +07:00 [DBG] Login Url: /Account/Login
2019-09-16 14:34:54.528 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-09-16 14:34:54.528 +07:00 [DBG] Logout Url: /Account/Logout
2019-09-16 14:34:54.528 +07:00 [DBG] ConsentUrl Url: /consent
2019-09-16 14:34:54.528 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2019-09-16 14:34:54.528 +07:00 [DBG] Error Url: /home/error
2019-09-16 14:34:54.528 +07:00 [DBG] Error Id Parameter: errorId
2019-09-16 14:34:54.534 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:54.548 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:34:54.653 +07:00 [ERR] Exception reading protected message
System.Security.Cryptography.CryptographicException: The key {3814f72e-773b-424e-a3db-e901d1c80e39} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at IdentityServer4.Stores.ProtectedDataMessageStore`1.ReadAsync(String value)
2019-09-16 14:35:01.961 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-09-16 14:35:01.966 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-09-16 14:35:01.966 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-09-16 14:35:01.969 +07:00 [DBG] Start discovery request
2019-09-16 14:35:02.103 +07:00 [DBG] Found ["profile","openid","api1"] as all scopes in database
2019-09-16 14:35:02.223 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:35:02.223 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:35:02.223 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-09-16 14:35:02.225 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-09-16 14:35:02.225 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-09-16 14:35:02.229 +07:00 [DBG] Start authorize request
2019-09-16 14:35:02.231 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:35:02.235 +07:00 [DBG] No user present in authorize request
2019-09-16 14:35:02.239 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:35:02.355 +07:00 [DBG] mvc found in database: true
2019-09-16 14:35:02.362 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:35:02.372 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:35:02.373 +07:00 [DBG] No PKCE used.
2019-09-16 14:35:02.408 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:35:02.507 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:35:02.517 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:35:02.519 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:35:02.526 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:35:02.536 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8OKyjJ2fDDVCuO4K3JNXVpWBuh3jbnxKRx2oFnA5GxHMK11QYsmRvXm5zJGwXxUHnFbxtrGR1eR-lk5MA-43zXXWPxJd48leGg0VYRIQ5zFp9SC_vAytje4IzjCVimYMYza9w33cqpNusUIeCasA0BfCtJgMZpG9nSQxp_yJYrEbc5oiQt14Yy2Vy_pb94EbK1VV1vVzhbWrAIAULdge4TEMWf4htSfGKcs0iKfbfe6wbEBU5f1J3nA15dYWkNAcgyhFHIvXh0BCA51K03qBTMJ31jjwRkUfeZiA_pqX94hoHOM9oRZVnVWeZCBg9LGsjZaDqShFSUP06Rm5-BRIFvU","UiLocales":null,"Nonce":"637042161022102431.ZmQ0ODUzYjUtZGI3MS00ZjIzLWE4MDctNTUxMWY3ZDI0YmYyNzVlZmQ4N2MtMjJlNi00ZWM1LWE1NmUtZjIxOTZmNDdhZTI4","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042161022102431.ZmQ0ODUzYjUtZGI3MS00ZjIzLWE4MDctNTUxMWY3ZDI0YmYyNzVlZmQ4N2MtMjJlNi00ZWM1LWE1NmUtZjIxOTZmNDdhZTI4","state":"CfDJ8OKyjJ2fDDVCuO4K3JNXVpWBuh3jbnxKRx2oFnA5GxHMK11QYsmRvXm5zJGwXxUHnFbxtrGR1eR-lk5MA-43zXXWPxJd48leGg0VYRIQ5zFp9SC_vAytje4IzjCVimYMYza9w33cqpNusUIeCasA0BfCtJgMZpG9nSQxp_yJYrEbc5oiQt14Yy2Vy_pb94EbK1VV1vVzhbWrAIAULdge4TEMWf4htSfGKcs0iKfbfe6wbEBU5f1J3nA15dYWkNAcgyhFHIvXh0BCA51K03qBTMJ31jjwRkUfeZiA_pqX94hoHOM9oRZVnVWeZCBg9LGsjZaDqShFSUP06Rm5-BRIFvU","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:35:02.546 +07:00 [INF] Showing login: User is not authenticated
2019-09-16 14:35:02.554 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:35:02.555 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:35:02.575 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:35:02.575 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:35:02.579 +07:00 [DBG] mvc found in database: true
2019-09-16 14:35:02.579 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:35:02.579 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:35:02.579 +07:00 [DBG] No PKCE used.
2019-09-16 14:35:02.580 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:35:02.582 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:35:02.583 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:35:02.585 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:35:02.585 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:35:02.589 +07:00 [DBG] mvc found in database: true
2019-09-16 14:35:02.589 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:35:02.605 +07:00 [ERR] An exception was thrown while deserializing the token.
Microsoft.AspNetCore.Antiforgery.AntiforgeryValidationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {74ec3aef-2f10-4a3e-a0cc-5335eb88dcab} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2019-09-16 14:35:08.660 +07:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-09-16 14:35:08.661 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:35:08.661 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:35:08.690 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:35:08.690 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:35:08.693 +07:00 [DBG] mvc found in database: true
2019-09-16 14:35:08.693 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:35:08.693 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:35:08.693 +07:00 [DBG] No PKCE used.
2019-09-16 14:35:08.695 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:35:08.699 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:35:08.701 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:35:08.703 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:35:08.703 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:35:08.719 +07:00 [DBG] Augmenting SignInContext
2019-09-16 14:35:08.721 +07:00 [DBG] Adding idp claim with value: local
2019-09-16 14:35:08.721 +07:00 [DBG] Adding amr claim with value: pwd
2019-09-16 14:35:08.723 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 14:35:08.729 +07:00 [INF] AuthenticationScheme: idsrv signed in.
2019-09-16 14:35:08.733 +07:00 [DBG] mvc found in database: true
2019-09-16 14:35:08.733 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:35:08.737 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-09-16 14:35:08.738 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-09-16 14:35:08.738 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-09-16 14:35:08.744 +07:00 [DBG] Start authorize callback request
2019-09-16 14:35:08.747 +07:00 [DBG] User in authorize request: 2
2019-09-16 14:35:08.747 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:35:08.750 +07:00 [DBG] mvc found in database: true
2019-09-16 14:35:08.750 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:35:08.750 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:35:08.750 +07:00 [DBG] No PKCE used.
2019-09-16 14:35:08.751 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:35:08.753 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:35:08.754 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:35:08.755 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:35:08.756 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:35:08.756 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8OKyjJ2fDDVCuO4K3JNXVpWBuh3jbnxKRx2oFnA5GxHMK11QYsmRvXm5zJGwXxUHnFbxtrGR1eR-lk5MA-43zXXWPxJd48leGg0VYRIQ5zFp9SC_vAytje4IzjCVimYMYza9w33cqpNusUIeCasA0BfCtJgMZpG9nSQxp_yJYrEbc5oiQt14Yy2Vy_pb94EbK1VV1vVzhbWrAIAULdge4TEMWf4htSfGKcs0iKfbfe6wbEBU5f1J3nA15dYWkNAcgyhFHIvXh0BCA51K03qBTMJ31jjwRkUfeZiA_pqX94hoHOM9oRZVnVWeZCBg9LGsjZaDqShFSUP06Rm5-BRIFvU","UiLocales":null,"Nonce":"637042161022102431.ZmQ0ODUzYjUtZGI3MS00ZjIzLWE4MDctNTUxMWY3ZDI0YmYyNzVlZmQ4N2MtMjJlNi00ZWM1LWE1NmUtZjIxOTZmNDdhZTI4","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"954774228eaa33cde677ef7e320e8128","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042161022102431.ZmQ0ODUzYjUtZGI3MS00ZjIzLWE4MDctNTUxMWY3ZDI0YmYyNzVlZmQ4N2MtMjJlNi00ZWM1LWE1NmUtZjIxOTZmNDdhZTI4","state":"CfDJ8OKyjJ2fDDVCuO4K3JNXVpWBuh3jbnxKRx2oFnA5GxHMK11QYsmRvXm5zJGwXxUHnFbxtrGR1eR-lk5MA-43zXXWPxJd48leGg0VYRIQ5zFp9SC_vAytje4IzjCVimYMYza9w33cqpNusUIeCasA0BfCtJgMZpG9nSQxp_yJYrEbc5oiQt14Yy2Vy_pb94EbK1VV1vVzhbWrAIAULdge4TEMWf4htSfGKcs0iKfbfe6wbEBU5f1J3nA15dYWkNAcgyhFHIvXh0BCA51K03qBTMJ31jjwRkUfeZiA_pqX94hoHOM9oRZVnVWeZCBg9LGsjZaDqShFSUP06Rm5-BRIFvU","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:35:08.757 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 14:35:08.765 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 14:35:08.765 +07:00 [INF] Showing consent: User has not yet consented
2019-09-16 14:35:08.783 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:35:08.786 +07:00 [DBG] mvc found in database: true
2019-09-16 14:35:08.786 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:35:08.786 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:35:08.786 +07:00 [DBG] No PKCE used.
2019-09-16 14:35:08.787 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:35:08.789 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:35:08.790 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:35:08.791 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:35:08.791 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:35:08.794 +07:00 [DBG] mvc found in database: true
2019-09-16 14:35:08.794 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:35:08.799 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:35:08.861 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:38:46.494 +07:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-09-16 14:38:46.508 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:38:46.526 +07:00 [DBG] mvc found in database: true
2019-09-16 14:38:46.526 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:38:46.526 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:38:46.527 +07:00 [DBG] No PKCE used.
2019-09-16 14:38:46.532 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:38:46.594 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:38:46.596 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:38:46.598 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:38:46.598 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:38:46.615 +07:00 [DBG] mvc found in database: true
2019-09-16 14:38:46.615 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:38:46.618 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-09-16 14:38:46.619 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-09-16 14:38:46.619 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-09-16 14:38:46.619 +07:00 [DBG] Start authorize callback request
2019-09-16 14:38:46.622 +07:00 [DBG] User in authorize request: 2
2019-09-16 14:38:46.622 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:38:46.625 +07:00 [DBG] mvc found in database: true
2019-09-16 14:38:46.625 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:38:46.626 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:38:46.626 +07:00 [DBG] No PKCE used.
2019-09-16 14:38:46.627 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:38:46.629 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:38:46.631 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:38:46.632 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:38:46.632 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:38:46.633 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8OKyjJ2fDDVCuO4K3JNXVpWBuh3jbnxKRx2oFnA5GxHMK11QYsmRvXm5zJGwXxUHnFbxtrGR1eR-lk5MA-43zXXWPxJd48leGg0VYRIQ5zFp9SC_vAytje4IzjCVimYMYza9w33cqpNusUIeCasA0BfCtJgMZpG9nSQxp_yJYrEbc5oiQt14Yy2Vy_pb94EbK1VV1vVzhbWrAIAULdge4TEMWf4htSfGKcs0iKfbfe6wbEBU5f1J3nA15dYWkNAcgyhFHIvXh0BCA51K03qBTMJ31jjwRkUfeZiA_pqX94hoHOM9oRZVnVWeZCBg9LGsjZaDqShFSUP06Rm5-BRIFvU","UiLocales":null,"Nonce":"637042161022102431.ZmQ0ODUzYjUtZGI3MS00ZjIzLWE4MDctNTUxMWY3ZDI0YmYyNzVlZmQ4N2MtMjJlNi00ZWM1LWE1NmUtZjIxOTZmNDdhZTI4","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"954774228eaa33cde677ef7e320e8128","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042161022102431.ZmQ0ODUzYjUtZGI3MS00ZjIzLWE4MDctNTUxMWY3ZDI0YmYyNzVlZmQ4N2MtMjJlNi00ZWM1LWE1NmUtZjIxOTZmNDdhZTI4","state":"CfDJ8OKyjJ2fDDVCuO4K3JNXVpWBuh3jbnxKRx2oFnA5GxHMK11QYsmRvXm5zJGwXxUHnFbxtrGR1eR-lk5MA-43zXXWPxJd48leGg0VYRIQ5zFp9SC_vAytje4IzjCVimYMYza9w33cqpNusUIeCasA0BfCtJgMZpG9nSQxp_yJYrEbc5oiQt14Yy2Vy_pb94EbK1VV1vVzhbWrAIAULdge4TEMWf4htSfGKcs0iKfbfe6wbEBU5f1J3nA15dYWkNAcgyhFHIvXh0BCA51K03qBTMJ31jjwRkUfeZiA_pqX94hoHOM9oRZVnVWeZCBg9LGsjZaDqShFSUP06Rm5-BRIFvU","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:38:46.633 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 14:38:46.633 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 14:38:46.633 +07:00 [INF] Error: User denied consent
2019-09-16 14:38:46.635 +07:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8OKyjJ2fDDVCuO4K3JNXVpWBuh3jbnxKRx2oFnA5GxHMK11QYsmRvXm5zJGwXxUHnFbxtrGR1eR-lk5MA-43zXXWPxJd48leGg0VYRIQ5zFp9SC_vAytje4IzjCVimYMYza9w33cqpNusUIeCasA0BfCtJgMZpG9nSQxp_yJYrEbc5oiQt14Yy2Vy_pb94EbK1VV1vVzhbWrAIAULdge4TEMWf4htSfGKcs0iKfbfe6wbEBU5f1J3nA15dYWkNAcgyhFHIvXh0BCA51K03qBTMJ31jjwRkUfeZiA_pqX94hoHOM9oRZVnVWeZCBg9LGsjZaDqShFSUP06Rm5-BRIFvU","UiLocales":null,"Nonce":"637042161022102431.ZmQ0ODUzYjUtZGI3MS00ZjIzLWE4MDctNTUxMWY3ZDI0YmYyNzVlZmQ4N2MtMjJlNi00ZWM1LWE1NmUtZjIxOTZmNDdhZTI4","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"954774228eaa33cde677ef7e320e8128","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042161022102431.ZmQ0ODUzYjUtZGI3MS00ZjIzLWE4MDctNTUxMWY3ZDI0YmYyNzVlZmQ4N2MtMjJlNi00ZWM1LWE1NmUtZjIxOTZmNDdhZTI4","state":"CfDJ8OKyjJ2fDDVCuO4K3JNXVpWBuh3jbnxKRx2oFnA5GxHMK11QYsmRvXm5zJGwXxUHnFbxtrGR1eR-lk5MA-43zXXWPxJd48leGg0VYRIQ5zFp9SC_vAytje4IzjCVimYMYza9w33cqpNusUIeCasA0BfCtJgMZpG9nSQxp_yJYrEbc5oiQt14Yy2Vy_pb94EbK1VV1vVzhbWrAIAULdge4TEMWf4htSfGKcs0iKfbfe6wbEBU5f1J3nA15dYWkNAcgyhFHIvXh0BCA51K03qBTMJ31jjwRkUfeZiA_pqX94hoHOM9oRZVnVWeZCBg9LGsjZaDqShFSUP06Rm5-BRIFvU","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:38:51.199 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:38:51.204 +07:00 [DBG] mvc found in database: true
2019-09-16 14:38:51.204 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:38:51.204 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:38:51.204 +07:00 [DBG] No PKCE used.
2019-09-16 14:38:51.206 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:38:51.208 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:38:51.209 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:38:51.211 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:38:51.211 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:38:51.214 +07:00 [DBG] mvc found in database: true
2019-09-16 14:38:51.214 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:38:51.221 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:38:51.286 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:38:52.723 +07:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-09-16 14:38:52.743 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:38:52.760 +07:00 [DBG] mvc found in database: true
2019-09-16 14:38:52.760 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:38:52.760 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:38:52.760 +07:00 [DBG] No PKCE used.
2019-09-16 14:38:52.764 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:38:52.829 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:38:52.830 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:38:52.832 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:38:52.833 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:38:52.848 +07:00 [DBG] mvc found in database: true
2019-09-16 14:38:52.848 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:38:52.858 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-09-16 14:38:52.859 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-09-16 14:38:52.859 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-09-16 14:38:52.859 +07:00 [DBG] Start authorize callback request
2019-09-16 14:38:52.860 +07:00 [DBG] User in authorize request: 2
2019-09-16 14:38:52.860 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:38:52.876 +07:00 [DBG] mvc found in database: true
2019-09-16 14:38:52.876 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:38:52.876 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:38:52.876 +07:00 [DBG] No PKCE used.
2019-09-16 14:38:52.882 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:38:52.946 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:38:52.951 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:38:53.014 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:38:53.014 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:38:53.014 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8OKyjJ2fDDVCuO4K3JNXVpWBuh3jbnxKRx2oFnA5GxHMK11QYsmRvXm5zJGwXxUHnFbxtrGR1eR-lk5MA-43zXXWPxJd48leGg0VYRIQ5zFp9SC_vAytje4IzjCVimYMYza9w33cqpNusUIeCasA0BfCtJgMZpG9nSQxp_yJYrEbc5oiQt14Yy2Vy_pb94EbK1VV1vVzhbWrAIAULdge4TEMWf4htSfGKcs0iKfbfe6wbEBU5f1J3nA15dYWkNAcgyhFHIvXh0BCA51K03qBTMJ31jjwRkUfeZiA_pqX94hoHOM9oRZVnVWeZCBg9LGsjZaDqShFSUP06Rm5-BRIFvU","UiLocales":null,"Nonce":"637042161022102431.ZmQ0ODUzYjUtZGI3MS00ZjIzLWE4MDctNTUxMWY3ZDI0YmYyNzVlZmQ4N2MtMjJlNi00ZWM1LWE1NmUtZjIxOTZmNDdhZTI4","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"954774228eaa33cde677ef7e320e8128","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042161022102431.ZmQ0ODUzYjUtZGI3MS00ZjIzLWE4MDctNTUxMWY3ZDI0YmYyNzVlZmQ4N2MtMjJlNi00ZWM1LWE1NmUtZjIxOTZmNDdhZTI4","state":"CfDJ8OKyjJ2fDDVCuO4K3JNXVpWBuh3jbnxKRx2oFnA5GxHMK11QYsmRvXm5zJGwXxUHnFbxtrGR1eR-lk5MA-43zXXWPxJd48leGg0VYRIQ5zFp9SC_vAytje4IzjCVimYMYza9w33cqpNusUIeCasA0BfCtJgMZpG9nSQxp_yJYrEbc5oiQt14Yy2Vy_pb94EbK1VV1vVzhbWrAIAULdge4TEMWf4htSfGKcs0iKfbfe6wbEBU5f1J3nA15dYWkNAcgyhFHIvXh0BCA51K03qBTMJ31jjwRkUfeZiA_pqX94hoHOM9oRZVnVWeZCBg9LGsjZaDqShFSUP06Rm5-BRIFvU","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:38:53.014 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 14:38:53.014 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 14:38:53.018 +07:00 [INF] User consented to scopes: ["profile","openid","api1","offline_access"]
2019-09-16 14:38:53.019 +07:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2019-09-16 14:38:53.022 +07:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 2
2019-09-16 14:38:53.045 +07:00 [DBG] QIM5q/EfBaHTA6V377/X6CDksjn7Imin78ZZLT1RY0E= found in database
2019-09-16 14:38:53.065 +07:00 [DBG] Creating Hybrid Flow response.
2019-09-16 14:38:53.083 +07:00 [DBG] Iklv4IaHNoA9PX5pThvks6OwDiF22CRxiae20ikBRbs= not found in database
2019-09-16 14:38:53.088 +07:00 [DBG] Creating Implicit Flow response.
2019-09-16 14:38:53.096 +07:00 [DBG] Getting claims for identity token for subject: 2 and client: mvc
2019-09-16 14:38:53.098 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-09-16 14:38:53.110 +07:00 [FTL] Unhandled exception: No signing credential is configured. Can't create JWT token
System.InvalidOperationException: No signing credential is configured. Can't create JWT token
   at IdentityServer4.Services.DefaultTokenCreationService.CreateHeaderAsync(Token token)
   at IdentityServer4.Services.DefaultTokenCreationService.CreateTokenAsync(Token token)
   at IdentityServer4.Services.DefaultTokenService.CreateSecurityTokenAsync(Token token)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateImplicitFlowResponseAsync(ValidatedAuthorizeRequest request, String authorizationCode)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateHybridFlowResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.Endpoints.AuthorizeEndpointBase.ProcessAuthorizeRequestAsync(NameValueCollection parameters, ClaimsPrincipal user, ConsentResponse consent)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events)
2019-09-16 14:38:53.111 +07:00 [ERR] Connection id "0HLPQF1F0G33U", Request id "0HLPQF1F0G33U:00000005": An unhandled exception was thrown by the application.
System.InvalidOperationException: No signing credential is configured. Can't create JWT token
   at IdentityServer4.Services.DefaultTokenCreationService.CreateHeaderAsync(Token token)
   at IdentityServer4.Services.DefaultTokenCreationService.CreateTokenAsync(Token token)
   at IdentityServer4.Services.DefaultTokenService.CreateSecurityTokenAsync(Token token)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateImplicitFlowResponseAsync(ValidatedAuthorizeRequest request, String authorizationCode)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateHybridFlowResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.Endpoints.AuthorizeEndpointBase.ProcessAuthorizeRequestAsync(NameValueCollection parameters, ClaimsPrincipal user, ConsentResponse consent)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events)
   at IdentityServer4.Hosting.MutualTlsTokenEndpointMiddleware.Invoke(HttpContext context, IAuthenticationSchemeProvider schemes)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at IdentityServer4.Hosting.BaseUrlMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.IISIntegration.IISMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2019-09-16 14:42:15.641 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-09-16 14:42:15.641 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-09-16 14:42:15.641 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-09-16 14:42:15.641 +07:00 [DBG] Start discovery request
2019-09-16 14:42:15.656 +07:00 [DBG] Found ["profile","openid","api1"] as all scopes in database
2019-09-16 14:42:15.731 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-09-16 14:42:15.731 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-09-16 14:42:15.731 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-09-16 14:42:15.731 +07:00 [DBG] Start authorize request
2019-09-16 14:42:15.732 +07:00 [DBG] User in authorize request: 2
2019-09-16 14:42:15.732 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:42:15.747 +07:00 [DBG] mvc found in database: true
2019-09-16 14:42:15.747 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:42:15.747 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:42:15.747 +07:00 [DBG] No PKCE used.
2019-09-16 14:42:15.752 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:42:15.813 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:42:15.814 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:42:15.817 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:42:15.817 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:42:15.817 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8H68j-48zuxOiKt3AINVf2q0pR3vUmIEpSYuXbcKgHxdL4qxVNE_5FJBuaCdhF3pvWje6lg5TtKuPr5tntLf7Yxx1nrkYGGcUqlW4Rlxr7K8mW89iJlo3eXaINWMRk5Q7ecqy3wC1W-1CvU4KafCJg0Jb9ToWMNO-UDyrkhqQJVtTV2ceGUqZz1X8LB-VGrAofuFJFAR9nABIocoKI9O_g6uF27ZC3h8SR0ebZIhFbBjfa8XaelB1NrDtgCK8_LkH8o-ZUARKMxgrTfnCvBW8D7SkmSInc3BgDW6XXQVvyp_duOYauFOUAq1JYxqjLPQL0K7kk6d5S3UDYcrEC4RW7g","UiLocales":null,"Nonce":"637042165357182558.N2NlNzJmZjUtMzg4Mi00Y2NjLWE2Y2UtZTkxNDA0MzU4YTdmOTg4Y2EwNTctMTE5My00NDUwLTllOGEtYmY1OWM3MjI3OTJm","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"954774228eaa33cde677ef7e320e8128","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042165357182558.N2NlNzJmZjUtMzg4Mi00Y2NjLWE2Y2UtZTkxNDA0MzU4YTdmOTg4Y2EwNTctMTE5My00NDUwLTllOGEtYmY1OWM3MjI3OTJm","state":"CfDJ8H68j-48zuxOiKt3AINVf2q0pR3vUmIEpSYuXbcKgHxdL4qxVNE_5FJBuaCdhF3pvWje6lg5TtKuPr5tntLf7Yxx1nrkYGGcUqlW4Rlxr7K8mW89iJlo3eXaINWMRk5Q7ecqy3wC1W-1CvU4KafCJg0Jb9ToWMNO-UDyrkhqQJVtTV2ceGUqZz1X8LB-VGrAofuFJFAR9nABIocoKI9O_g6uF27ZC3h8SR0ebZIhFbBjfa8XaelB1NrDtgCK8_LkH8o-ZUARKMxgrTfnCvBW8D7SkmSInc3BgDW6XXQVvyp_duOYauFOUAq1JYxqjLPQL0K7kk6d5S3UDYcrEC4RW7g","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:42:15.817 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 14:42:15.817 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 14:42:15.817 +07:00 [INF] Showing consent: User has not yet consented
2019-09-16 14:42:15.821 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:42:15.824 +07:00 [DBG] mvc found in database: true
2019-09-16 14:42:15.824 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:42:15.824 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:42:15.824 +07:00 [DBG] No PKCE used.
2019-09-16 14:42:15.825 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:42:15.827 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:42:15.828 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:42:15.830 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:42:15.830 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:42:15.832 +07:00 [DBG] mvc found in database: true
2019-09-16 14:42:15.832 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:42:15.837 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:42:15.898 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:42:17.650 +07:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-09-16 14:42:17.651 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:42:17.655 +07:00 [DBG] mvc found in database: true
2019-09-16 14:42:17.656 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:42:17.656 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:42:17.656 +07:00 [DBG] No PKCE used.
2019-09-16 14:42:17.658 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:42:17.659 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:42:17.661 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:42:17.663 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:42:17.663 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:42:17.665 +07:00 [ERR] Error unprotecting message cookie
System.Security.Cryptography.CryptographicException: The key {74ec3aef-2f10-4a3e-a0cc-5335eb88dcab} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.DataProtection.DataProtectionCommonExtensions.Unprotect(IDataProtector protector, String protectedData)
   at IdentityServer4.MessageCookie`1.Unprotect(String data)
   at IdentityServer4.MessageCookie`1.ReadByCookieName(String name)
2019-09-16 14:42:17.671 +07:00 [DBG] mvc found in database: true
2019-09-16 14:42:17.671 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:42:17.676 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-09-16 14:42:17.677 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-09-16 14:42:17.677 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-09-16 14:42:17.677 +07:00 [DBG] Start authorize callback request
2019-09-16 14:42:17.677 +07:00 [DBG] User in authorize request: 2
2019-09-16 14:42:17.677 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 14:42:17.680 +07:00 [DBG] mvc found in database: true
2019-09-16 14:42:17.680 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 14:42:17.680 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 14:42:17.681 +07:00 [DBG] No PKCE used.
2019-09-16 14:42:17.682 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:42:17.684 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:42:17.685 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 14:42:17.686 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 14:42:17.686 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 14:42:17.687 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8H68j-48zuxOiKt3AINVf2q0pR3vUmIEpSYuXbcKgHxdL4qxVNE_5FJBuaCdhF3pvWje6lg5TtKuPr5tntLf7Yxx1nrkYGGcUqlW4Rlxr7K8mW89iJlo3eXaINWMRk5Q7ecqy3wC1W-1CvU4KafCJg0Jb9ToWMNO-UDyrkhqQJVtTV2ceGUqZz1X8LB-VGrAofuFJFAR9nABIocoKI9O_g6uF27ZC3h8SR0ebZIhFbBjfa8XaelB1NrDtgCK8_LkH8o-ZUARKMxgrTfnCvBW8D7SkmSInc3BgDW6XXQVvyp_duOYauFOUAq1JYxqjLPQL0K7kk6d5S3UDYcrEC4RW7g","UiLocales":null,"Nonce":"637042165357182558.N2NlNzJmZjUtMzg4Mi00Y2NjLWE2Y2UtZTkxNDA0MzU4YTdmOTg4Y2EwNTctMTE5My00NDUwLTllOGEtYmY1OWM3MjI3OTJm","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"954774228eaa33cde677ef7e320e8128","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042165357182558.N2NlNzJmZjUtMzg4Mi00Y2NjLWE2Y2UtZTkxNDA0MzU4YTdmOTg4Y2EwNTctMTE5My00NDUwLTllOGEtYmY1OWM3MjI3OTJm","state":"CfDJ8H68j-48zuxOiKt3AINVf2q0pR3vUmIEpSYuXbcKgHxdL4qxVNE_5FJBuaCdhF3pvWje6lg5TtKuPr5tntLf7Yxx1nrkYGGcUqlW4Rlxr7K8mW89iJlo3eXaINWMRk5Q7ecqy3wC1W-1CvU4KafCJg0Jb9ToWMNO-UDyrkhqQJVtTV2ceGUqZz1X8LB-VGrAofuFJFAR9nABIocoKI9O_g6uF27ZC3h8SR0ebZIhFbBjfa8XaelB1NrDtgCK8_LkH8o-ZUARKMxgrTfnCvBW8D7SkmSInc3BgDW6XXQVvyp_duOYauFOUAq1JYxqjLPQL0K7kk6d5S3UDYcrEC4RW7g","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 14:42:17.687 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 14:42:17.687 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 14:42:17.687 +07:00 [INF] User consented to scopes: ["profile","openid","api1","offline_access"]
2019-09-16 14:42:17.687 +07:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2019-09-16 14:42:17.687 +07:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 2
2019-09-16 14:42:17.688 +07:00 [DBG] QIM5q/EfBaHTA6V377/X6CDksjn7Imin78ZZLT1RY0E= found in database
2019-09-16 14:42:17.690 +07:00 [DBG] Creating Hybrid Flow response.
2019-09-16 14:42:17.690 +07:00 [DBG] oAmEt55xQvBjFIJO1wUun53RF2EKZIlTq0djlpzZAnA= not found in database
2019-09-16 14:42:17.692 +07:00 [DBG] Creating Implicit Flow response.
2019-09-16 14:42:17.692 +07:00 [DBG] Getting claims for identity token for subject: 2 and client: mvc
2019-09-16 14:42:17.692 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-09-16 14:42:17.693 +07:00 [FTL] Unhandled exception: No signing credential is configured. Can't create JWT token
System.InvalidOperationException: No signing credential is configured. Can't create JWT token
   at IdentityServer4.Services.DefaultTokenCreationService.CreateHeaderAsync(Token token)
   at IdentityServer4.Services.DefaultTokenCreationService.CreateTokenAsync(Token token)
   at IdentityServer4.Services.DefaultTokenService.CreateSecurityTokenAsync(Token token)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateImplicitFlowResponseAsync(ValidatedAuthorizeRequest request, String authorizationCode)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateHybridFlowResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.Endpoints.AuthorizeEndpointBase.ProcessAuthorizeRequestAsync(NameValueCollection parameters, ClaimsPrincipal user, ConsentResponse consent)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events)
2019-09-16 14:42:17.693 +07:00 [ERR] Connection id "0HLPQF1F0G340", Request id "0HLPQF1F0G340:00000002": An unhandled exception was thrown by the application.
System.InvalidOperationException: No signing credential is configured. Can't create JWT token
   at IdentityServer4.Services.DefaultTokenCreationService.CreateHeaderAsync(Token token)
   at IdentityServer4.Services.DefaultTokenCreationService.CreateTokenAsync(Token token)
   at IdentityServer4.Services.DefaultTokenService.CreateSecurityTokenAsync(Token token)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateImplicitFlowResponseAsync(ValidatedAuthorizeRequest request, String authorizationCode)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateHybridFlowResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.ResponseHandling.AuthorizeResponseGenerator.CreateResponseAsync(ValidatedAuthorizeRequest request)
   at IdentityServer4.Endpoints.AuthorizeEndpointBase.ProcessAuthorizeRequestAsync(NameValueCollection parameters, ClaimsPrincipal user, ConsentResponse consent)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Endpoints.AuthorizeCallbackEndpoint.ProcessAsync(HttpContext context)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events)
   at IdentityServer4.Hosting.IdentityServerMiddleware.Invoke(HttpContext context, IEndpointRouter router, IUserSession session, IEventService events)
   at IdentityServer4.Hosting.MutualTlsTokenEndpointMiddleware.Invoke(HttpContext context, IAuthenticationSchemeProvider schemes)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at IdentityServer4.Hosting.BaseUrlMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Server.IISIntegration.IISMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2019-09-16 14:43:54.545 +07:00 [DBG] Stopping grant removal
2019-09-16 14:43:54.546 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 15:08:01.288 +07:00 [WRN] Using an in-memory repository. Keys will not be persisted to storage.
2019-09-16 15:08:01.310 +07:00 [WRN] Neither user profile nor HKLM registry available. Using an ephemeral key repository. Protected data will be unavailable when application exits.
2019-09-16 15:08:01.322 +07:00 [WRN] No XML encryptor configured. Key "ad657c10-9313-4ae0-bffe-c5070eedeefe" may be persisted to storage in unencrypted form.
2019-09-16 15:08:02.751 +07:00 [INF] Starting IdentityServer4 version 2.5.0.0
2019-09-16 15:08:02.767 +07:00 [INF] Using the default authentication scheme idsrv for IdentityServer
2019-09-16 15:08:02.767 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for authentication
2019-09-16 15:08:02.767 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-in
2019-09-16 15:08:02.767 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-out
2019-09-16 15:08:02.767 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for challenge
2019-09-16 15:08:02.767 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for forbid
2019-09-16 15:08:02.850 +07:00 [DBG] Starting grant removal
2019-09-16 15:08:02.974 +07:00 [DBG] Login Url: /Account/Login
2019-09-16 15:08:02.976 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-09-16 15:08:02.976 +07:00 [DBG] Logout Url: /Account/Logout
2019-09-16 15:08:02.976 +07:00 [DBG] ConsentUrl Url: /consent
2019-09-16 15:08:02.976 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2019-09-16 15:08:02.976 +07:00 [DBG] Error Url: /home/error
2019-09-16 15:08:02.976 +07:00 [DBG] Error Id Parameter: errorId
2019-09-16 15:08:02.999 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-09-16 15:08:03.010 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-09-16 15:08:03.010 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-09-16 15:08:03.013 +07:00 [DBG] Start authorize request
2019-09-16 15:08:03.022 +07:00 [DBG] No user present in authorize request
2019-09-16 15:08:03.026 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:03.150 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:03.158 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:03.169 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:03.171 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:03.223 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:03.376 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:03.389 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:03.391 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:03.399 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:03.408 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8FuBqvJbe1BMn8cXC_nEjgtDbrrH3WRfL7qR1hhRzWeWhnl4xENCXp64k0MzpoHW9MoCe3b0fsohcNNU1DBwqH51YeApQrA5DOv3z9D9MkISUpAbMizOOxSkTvijUI3mO77vsIyif_STWoJLgqxERbDl7o3rbc350vvchg8QHSYSZDZCR-lvwhgd28ubKls_GV3WtF05nv0Ik3uu-BObE77t-yV2xzpiT6FxueKIXoM2b2Yfk2sWYGipBSXtgsQCf4sEfxmF7TSmCp_F1SEz03zutB2Emv2MRgXT29KErVDaqt9E9tCUjLVG8EjbbK2HwDiMQmfRiKLPNrR-GbC54ac","UiLocales":null,"Nonce":"637042180802636827.MjBmY2JiODgtOTVjNS00NGM2LWI1ODQtOTM1NTU2MTA0OGY5MjI1MWMwMDUtZWUwOS00MDM2LTk1Y2QtNjMzNzliMzE2Yjg0","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042180802636827.MjBmY2JiODgtOTVjNS00NGM2LWI1ODQtOTM1NTU2MTA0OGY5MjI1MWMwMDUtZWUwOS00MDM2LTk1Y2QtNjMzNzliMzE2Yjg0","state":"CfDJ8FuBqvJbe1BMn8cXC_nEjgtDbrrH3WRfL7qR1hhRzWeWhnl4xENCXp64k0MzpoHW9MoCe3b0fsohcNNU1DBwqH51YeApQrA5DOv3z9D9MkISUpAbMizOOxSkTvijUI3mO77vsIyif_STWoJLgqxERbDl7o3rbc350vvchg8QHSYSZDZCR-lvwhgd28ubKls_GV3WtF05nv0Ik3uu-BObE77t-yV2xzpiT6FxueKIXoM2b2Yfk2sWYGipBSXtgsQCf4sEfxmF7TSmCp_F1SEz03zutB2Emv2MRgXT29KErVDaqt9E9tCUjLVG8EjbbK2HwDiMQmfRiKLPNrR-GbC54ac","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 15:08:03.419 +07:00 [INF] Showing login: User is not authenticated
2019-09-16 15:08:03.545 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:03.549 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:03.549 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:03.549 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:03.549 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:03.551 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:03.553 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:03.554 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:03.556 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:03.556 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:03.560 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:03.561 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:03.612 +07:00 [ERR] An exception was thrown while deserializing the token.
Microsoft.AspNetCore.Antiforgery.AntiforgeryValidationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {87b55cc9-0414-4879-b09f-45d25b2feb63} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2019-09-16 15:08:09.785 +07:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-09-16 15:08:09.817 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:09.820 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:09.821 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:09.821 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:09.821 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:09.822 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:09.825 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:09.825 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:09.827 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:09.827 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:09.844 +07:00 [DBG] Augmenting SignInContext
2019-09-16 15:08:09.845 +07:00 [DBG] Adding idp claim with value: local
2019-09-16 15:08:09.845 +07:00 [DBG] Adding amr claim with value: pwd
2019-09-16 15:08:09.852 +07:00 [INF] AuthenticationScheme: idsrv signed in.
2019-09-16 15:08:09.856 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:09.856 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:09.860 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-09-16 15:08:09.861 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-09-16 15:08:09.861 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-09-16 15:08:09.867 +07:00 [DBG] Start authorize callback request
2019-09-16 15:08:09.870 +07:00 [DBG] User in authorize request: 2
2019-09-16 15:08:09.870 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:09.873 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:09.873 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:09.873 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:09.874 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:09.874 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:09.876 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:09.877 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:09.879 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:09.879 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:09.879 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8FuBqvJbe1BMn8cXC_nEjgtDbrrH3WRfL7qR1hhRzWeWhnl4xENCXp64k0MzpoHW9MoCe3b0fsohcNNU1DBwqH51YeApQrA5DOv3z9D9MkISUpAbMizOOxSkTvijUI3mO77vsIyif_STWoJLgqxERbDl7o3rbc350vvchg8QHSYSZDZCR-lvwhgd28ubKls_GV3WtF05nv0Ik3uu-BObE77t-yV2xzpiT6FxueKIXoM2b2Yfk2sWYGipBSXtgsQCf4sEfxmF7TSmCp_F1SEz03zutB2Emv2MRgXT29KErVDaqt9E9tCUjLVG8EjbbK2HwDiMQmfRiKLPNrR-GbC54ac","UiLocales":null,"Nonce":"637042180802636827.MjBmY2JiODgtOTVjNS00NGM2LWI1ODQtOTM1NTU2MTA0OGY5MjI1MWMwMDUtZWUwOS00MDM2LTk1Y2QtNjMzNzliMzE2Yjg0","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"b816213947bd13176186eb3d32f0fd02","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042180802636827.MjBmY2JiODgtOTVjNS00NGM2LWI1ODQtOTM1NTU2MTA0OGY5MjI1MWMwMDUtZWUwOS00MDM2LTk1Y2QtNjMzNzliMzE2Yjg0","state":"CfDJ8FuBqvJbe1BMn8cXC_nEjgtDbrrH3WRfL7qR1hhRzWeWhnl4xENCXp64k0MzpoHW9MoCe3b0fsohcNNU1DBwqH51YeApQrA5DOv3z9D9MkISUpAbMizOOxSkTvijUI3mO77vsIyif_STWoJLgqxERbDl7o3rbc350vvchg8QHSYSZDZCR-lvwhgd28ubKls_GV3WtF05nv0Ik3uu-BObE77t-yV2xzpiT6FxueKIXoM2b2Yfk2sWYGipBSXtgsQCf4sEfxmF7TSmCp_F1SEz03zutB2Emv2MRgXT29KErVDaqt9E9tCUjLVG8EjbbK2HwDiMQmfRiKLPNrR-GbC54ac","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 15:08:09.880 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 15:08:09.888 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 15:08:09.888 +07:00 [INF] Showing consent: User has not yet consented
2019-09-16 15:08:09.907 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:09.910 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:09.910 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:09.910 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:09.910 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:09.911 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:09.913 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:09.914 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:09.915 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:09.915 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:09.917 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:09.917 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:09.922 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:09.983 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:11.149 +07:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-09-16 15:08:11.168 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:11.173 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:11.173 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:11.173 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:11.173 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:11.176 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:11.179 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:11.180 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:11.182 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:11.182 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:11.200 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:11.200 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:11.204 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-09-16 15:08:11.205 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-09-16 15:08:11.205 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-09-16 15:08:11.205 +07:00 [DBG] Start authorize callback request
2019-09-16 15:08:11.209 +07:00 [DBG] User in authorize request: 2
2019-09-16 15:08:11.210 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:11.213 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:11.213 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:11.213 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:11.213 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:11.215 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:11.217 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:11.218 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:11.220 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:11.220 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:11.220 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8FuBqvJbe1BMn8cXC_nEjgtDbrrH3WRfL7qR1hhRzWeWhnl4xENCXp64k0MzpoHW9MoCe3b0fsohcNNU1DBwqH51YeApQrA5DOv3z9D9MkISUpAbMizOOxSkTvijUI3mO77vsIyif_STWoJLgqxERbDl7o3rbc350vvchg8QHSYSZDZCR-lvwhgd28ubKls_GV3WtF05nv0Ik3uu-BObE77t-yV2xzpiT6FxueKIXoM2b2Yfk2sWYGipBSXtgsQCf4sEfxmF7TSmCp_F1SEz03zutB2Emv2MRgXT29KErVDaqt9E9tCUjLVG8EjbbK2HwDiMQmfRiKLPNrR-GbC54ac","UiLocales":null,"Nonce":"637042180802636827.MjBmY2JiODgtOTVjNS00NGM2LWI1ODQtOTM1NTU2MTA0OGY5MjI1MWMwMDUtZWUwOS00MDM2LTk1Y2QtNjMzNzliMzE2Yjg0","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"b816213947bd13176186eb3d32f0fd02","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042180802636827.MjBmY2JiODgtOTVjNS00NGM2LWI1ODQtOTM1NTU2MTA0OGY5MjI1MWMwMDUtZWUwOS00MDM2LTk1Y2QtNjMzNzliMzE2Yjg0","state":"CfDJ8FuBqvJbe1BMn8cXC_nEjgtDbrrH3WRfL7qR1hhRzWeWhnl4xENCXp64k0MzpoHW9MoCe3b0fsohcNNU1DBwqH51YeApQrA5DOv3z9D9MkISUpAbMizOOxSkTvijUI3mO77vsIyif_STWoJLgqxERbDl7o3rbc350vvchg8QHSYSZDZCR-lvwhgd28ubKls_GV3WtF05nv0Ik3uu-BObE77t-yV2xzpiT6FxueKIXoM2b2Yfk2sWYGipBSXtgsQCf4sEfxmF7TSmCp_F1SEz03zutB2Emv2MRgXT29KErVDaqt9E9tCUjLVG8EjbbK2HwDiMQmfRiKLPNrR-GbC54ac","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 15:08:11.220 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 15:08:11.221 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 15:08:11.227 +07:00 [INF] User consented to scopes: ["profile","openid","api1","offline_access"]
2019-09-16 15:08:11.228 +07:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2019-09-16 15:08:11.231 +07:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 2
2019-09-16 15:08:11.256 +07:00 [DBG] QIM5q/EfBaHTA6V377/X6CDksjn7Imin78ZZLT1RY0E= found in database
2019-09-16 15:08:11.277 +07:00 [DBG] Creating Hybrid Flow response.
2019-09-16 15:08:11.293 +07:00 [DBG] deHKz93kjuqVjqCpNPKBoPajW6KnzsHfAS0M1/n7MSc= not found in database
2019-09-16 15:08:11.299 +07:00 [DBG] Creating Implicit Flow response.
2019-09-16 15:08:11.307 +07:00 [DBG] Getting claims for identity token for subject: 2 and client: mvc
2019-09-16 15:08:11.308 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-09-16 15:08:11.342 +07:00 [DBG] Authorize endpoint response
{"SubjectId":"2","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8FuBqvJbe1BMn8cXC_nEjgtDbrrH3WRfL7qR1hhRzWeWhnl4xENCXp64k0MzpoHW9MoCe3b0fsohcNNU1DBwqH51YeApQrA5DOv3z9D9MkISUpAbMizOOxSkTvijUI3mO77vsIyif_STWoJLgqxERbDl7o3rbc350vvchg8QHSYSZDZCR-lvwhgd28ubKls_GV3WtF05nv0Ik3uu-BObE77t-yV2xzpiT6FxueKIXoM2b2Yfk2sWYGipBSXtgsQCf4sEfxmF7TSmCp_F1SEz03zutB2Emv2MRgXT29KErVDaqt9E9tCUjLVG8EjbbK2HwDiMQmfRiKLPNrR-GbC54ac","Scope":"openid profile api1 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-09-16 15:08:11.357 +07:00 [DBG] Augmenting SignInContext
2019-09-16 15:08:11.357 +07:00 [INF] AuthenticationScheme: idsrv signed in.
2019-09-16 15:08:46.110 +07:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-09-16 15:08:46.112 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-09-16 15:08:46.112 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-09-16 15:08:46.115 +07:00 [DBG] Start discovery request
2019-09-16 15:08:46.195 +07:00 [DBG] Found ["profile","openid","api1"] as all scopes in database
2019-09-16 15:08:46.213 +07:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-09-16 15:08:46.213 +07:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-09-16 15:08:46.213 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-09-16 15:08:46.217 +07:00 [DBG] Start key discovery request
2019-09-16 15:08:46.229 +07:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-09-16 15:08:46.232 +07:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-09-16 15:08:46.232 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-09-16 15:08:46.239 +07:00 [DBG] Start token request.
2019-09-16 15:08:46.243 +07:00 [DBG] Start client validation
2019-09-16 15:08:46.248 +07:00 [DBG] Start parsing Basic Authentication secret
2019-09-16 15:08:46.252 +07:00 [DBG] Start parsing for secret in post body
2019-09-16 15:08:46.252 +07:00 [DBG] Parser found secret: PostBodySecretParser
2019-09-16 15:08:46.252 +07:00 [DBG] Secret id found: mvc
2019-09-16 15:08:46.270 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:46.270 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:46.277 +07:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-09-16 15:08:46.277 +07:00 [DBG] Client validation success
2019-09-16 15:08:46.282 +07:00 [DBG] Start token request validation
2019-09-16 15:08:46.291 +07:00 [DBG] Start validation of authorization code token request
2019-09-16 15:08:46.305 +07:00 [DBG] deHKz93kjuqVjqCpNPKBoPajW6KnzsHfAS0M1/n7MSc= found in database: true
2019-09-16 15:08:46.319 +07:00 [DBG] removing deHKz93kjuqVjqCpNPKBoPajW6KnzsHfAS0M1/n7MSc= persisted grant from database
2019-09-16 15:08:46.321 +07:00 [DBG] IsActive called from: AuthorizationCodeValidation
2019-09-16 15:08:46.321 +07:00 [DBG] Validation of authorization code token request success
2019-09-16 15:08:46.323 +07:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"4d0318f52039f916c8a91aa2dddc2da36ac2dfd523cbf6ddc204b2d7cf76dbe6","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"4d0318f52039f916c8a91aa2dddc2da36ac2dfd523cbf6ddc204b2d7cf76dbe6","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-09-16 15:08:46.337 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:46.337 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:46.342 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:46.406 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:46.416 +07:00 [DBG] Getting claims for access token for client: mvc
2019-09-16 15:08:46.417 +07:00 [DBG] Getting claims for access token for subject: 2
2019-09-16 15:08:46.418 +07:00 [DBG] Get profile called for subject 2 from client MVC Client with claim types [] via ClaimsProviderAccessToken
2019-09-16 15:08:46.419 +07:00 [DBG] Issued claims: []
2019-09-16 15:08:46.424 +07:00 [DBG] Creating refresh token
2019-09-16 15:08:46.424 +07:00 [DBG] Setting an absolute lifetime: 2592000
2019-09-16 15:08:46.434 +07:00 [DBG] p/0iMdljQgQ+23dryOX+ZASuEyJMIXDJAzQ3fFFnj2c= not found in database
2019-09-16 15:08:46.438 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:46.438 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:46.439 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:46.442 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:46.442 +07:00 [DBG] Getting claims for identity token for subject: 2 and client: mvc
2019-09-16 15:08:46.442 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-09-16 15:08:46.446 +07:00 [DBG] Token request success.
2019-09-16 15:08:46.453 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-09-16 15:08:46.453 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-09-16 15:08:46.453 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-09-16 15:08:46.459 +07:00 [DBG] Start userinfo request
2019-09-16 15:08:46.461 +07:00 [DBG] Bearer token found in header
2019-09-16 15:08:46.484 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:46.484 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:46.489 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:46.489 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:46.490 +07:00 [DBG] IsActive called from: AccessTokenValidation
2019-09-16 15:08:46.490 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-09-16 15:08:46.491 +07:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1568621326,"exp":1568624926,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"2","auth_time":1568621289,"idp":"local","scope":["profile","openid","api1","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-09-16 15:08:46.491 +07:00 [DBG] IsActive called from: UserInfoRequestValidation
2019-09-16 15:08:46.496 +07:00 [DBG] Creating userinfo response
2019-09-16 15:08:46.499 +07:00 [DBG] Scopes in access token: profile openid api1 offline_access
2019-09-16 15:08:46.501 +07:00 [DBG] Scopes in access token: profile openid api1 offline_access
2019-09-16 15:08:46.508 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:46.509 +07:00 [DBG] Requested claim types: updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name sub
2019-09-16 15:08:46.509 +07:00 [DBG] Scopes in access token: profile openid api1 offline_access
2019-09-16 15:08:46.511 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:46.511 +07:00 [DBG] Get profile called for subject 2 from client MVC Client with claim types ["updated_at","locale","zoneinfo","birthdate","gender","website","picture","profile","preferred_username","nickname","middle_name","given_name","family_name","name","sub"] via UserInfoEndpoint
2019-09-16 15:08:46.512 +07:00 [DBG] Issued claims: ["name","website"]
2019-09-16 15:08:46.512 +07:00 [INF] Profile service returned the following claim types: name website
2019-09-16 15:08:46.512 +07:00 [DBG] End userinfo request
2019-09-16 15:08:48.362 +07:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2019-09-16 15:08:48.363 +07:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2019-09-16 15:08:48.363 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2019-09-16 15:08:48.368 +07:00 [DBG] Processing signout request for 2
2019-09-16 15:08:48.373 +07:00 [DBG] Start end session request validation
2019-09-16 15:08:48.377 +07:00 [DBG] Start identity token validation
2019-09-16 15:08:48.381 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:48.381 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:48.381 +07:00 [DBG] Client found: mvc / MVC Client
2019-09-16 15:08:48.382 +07:00 [DBG] IsActive called from: IdentityTokenValidation
2019-09-16 15:08:48.382 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-09-16 15:08:48.383 +07:00 [DBG] Token validation success
{"ClientId":"mvc","ClientName":"MVC Client","ValidateLifetime":false,"AccessTokenType":null,"ExpectedScope":null,"TokenHandle":null,"JwtId":null,"Claims":{"nbf":1568621326,"exp":1568621626,"iss":"http://localhost:5000","aud":"mvc","nonce":"637042180802636827.MjBmY2JiODgtOTVjNS00NGM2LWI1ODQtOTM1NTU2MTA0OGY5MjI1MWMwMDUtZWUwOS00MDM2LTk1Y2QtNjMzNzliMzE2Yjg0","iat":1568621326,"at_hash":"UUTSUoaq54kMD9590TYAzA","sid":"b816213947bd13176186eb3d32f0fd02","sub":"2","auth_time":1568621289,"idp":"local","amr":"pwd"},"$type":"TokenValidationLog"}
2019-09-16 15:08:48.385 +07:00 [INF] End session request validation success
{"ClientId":"mvc","ClientName":"MVC Client","SubjectId":"2","PostLogOutUri":"http://localhost:5002/signout-callback-oidc","State":"CfDJ8FuBqvJbe1BMn8cXC_nEjgsmCZ-X03QzvZwJIQbac04jaPh3jH4UKA9bJQ_6-8baxuhCZN2D8zY8ARfUiX81HTbhoKoHu-Et4B-syQaue9zTM1pXNJaP3EM0FlSU0NCCg_pHUrTP-BFkDgyDRmju4qOCgM-KAKaWmR6mqCOiOWx0","Raw":{"post_logout_redirect_uri":"http://localhost:5002/signout-callback-oidc","id_token_hint":"***REDACTED***","state":"CfDJ8FuBqvJbe1BMn8cXC_nEjgsmCZ-X03QzvZwJIQbac04jaPh3jH4UKA9bJQ_6-8baxuhCZN2D8zY8ARfUiX81HTbhoKoHu-Et4B-syQaue9zTM1pXNJaP3EM0FlSU0NCCg_pHUrTP-BFkDgyDRmju4qOCgM-KAKaWmR6mqCOiOWx0","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"EndSessionRequestValidationLog"}
2019-09-16 15:08:48.385 +07:00 [DBG] Success validating end session request from mvc
2019-09-16 15:08:48.424 +07:00 [INF] AuthenticationScheme: idsrv signed out.
2019-09-16 15:08:48.455 +07:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2019-09-16 15:08:48.457 +07:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2019-09-16 15:08:48.457 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2019-09-16 15:08:48.461 +07:00 [DBG] Processing signout callback request
2019-09-16 15:08:48.477 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:48.477 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:48.477 +07:00 [DBG] No client front-channel logout URLs
2019-09-16 15:08:48.477 +07:00 [DBG] No client back-channel logout URLs
2019-09-16 15:08:48.477 +07:00 [INF] Successful signout callback.
2019-09-16 15:08:48.477 +07:00 [DBG] No client front-channel iframe urls
2019-09-16 15:08:48.477 +07:00 [DBG] No client back-channel iframe urls
2019-09-16 15:08:51.866 +07:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-09-16 15:08:51.868 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-09-16 15:08:51.869 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-09-16 15:08:51.869 +07:00 [DBG] Start authorize request
2019-09-16 15:08:51.869 +07:00 [DBG] No user present in authorize request
2019-09-16 15:08:51.869 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:51.872 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:51.872 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:51.872 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:51.872 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:51.877 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:51.944 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:51.945 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:51.947 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:51.947 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:51.947 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8FuBqvJbe1BMn8cXC_nEjguMMScTY4DFU8b7ALd9DKJCWkUI0KNgRJW9zChlPuWMtja_Ex-brk4m7PwMr5a16koHn1SGSvkhFyEUbXfwsmTwNiyJXCz5TF_Pzdt5OHOxdEObDsC47_Wg6pREyQ2vgDAYu_mjVb39HNg0sE2w7qZVlTPKeaPWYY1fOZiIHLUZydeFFhQGXL8linrBsrtDh-U1p7IdmnV9SqjX5cyDDRqx21eqE27XobhqFeLnAa-Q3GVooW6FvRyDf0Tei0iGhjKFthSf5HnKLlR4txr9i0oAjJUOEj6e9U7Wwwp9YGv1x2ijJhE1ftfMzE9xno2s2i0","UiLocales":null,"Nonce":"637042181318619833.MGZhNTk2ZTAtZGYzMS00MjE2LWE3ZDctYzg3ZDNlNGNhNWJmMTNhZTkzMjYtN2U1MC00NTk1LWIwOWEtNGQ2ZDlkZDg2OTVh","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042181318619833.MGZhNTk2ZTAtZGYzMS00MjE2LWE3ZDctYzg3ZDNlNGNhNWJmMTNhZTkzMjYtN2U1MC00NTk1LWIwOWEtNGQ2ZDlkZDg2OTVh","state":"CfDJ8FuBqvJbe1BMn8cXC_nEjguMMScTY4DFU8b7ALd9DKJCWkUI0KNgRJW9zChlPuWMtja_Ex-brk4m7PwMr5a16koHn1SGSvkhFyEUbXfwsmTwNiyJXCz5TF_Pzdt5OHOxdEObDsC47_Wg6pREyQ2vgDAYu_mjVb39HNg0sE2w7qZVlTPKeaPWYY1fOZiIHLUZydeFFhQGXL8linrBsrtDh-U1p7IdmnV9SqjX5cyDDRqx21eqE27XobhqFeLnAa-Q3GVooW6FvRyDf0Tei0iGhjKFthSf5HnKLlR4txr9i0oAjJUOEj6e9U7Wwwp9YGv1x2ijJhE1ftfMzE9xno2s2i0","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 15:08:51.947 +07:00 [INF] Showing login: User is not authenticated
2019-09-16 15:08:51.951 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:51.954 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:51.955 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:51.955 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:51.955 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:51.956 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:51.957 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:51.958 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:51.960 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:51.960 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:51.963 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:51.963 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:55.183 +07:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-09-16 15:08:55.185 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:55.189 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:55.190 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:55.190 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:55.190 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:55.191 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:55.193 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:55.194 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:55.195 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:55.195 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:55.196 +07:00 [DBG] Augmenting SignInContext
2019-09-16 15:08:55.196 +07:00 [DBG] Adding idp claim with value: local
2019-09-16 15:08:55.196 +07:00 [DBG] Adding amr claim with value: pwd
2019-09-16 15:08:55.196 +07:00 [INF] AuthenticationScheme: idsrv signed in.
2019-09-16 15:08:55.198 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:55.198 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:55.202 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-09-16 15:08:55.203 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-09-16 15:08:55.203 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-09-16 15:08:55.203 +07:00 [DBG] Start authorize callback request
2019-09-16 15:08:55.203 +07:00 [DBG] User in authorize request: 2
2019-09-16 15:08:55.203 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:55.206 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:55.206 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:55.206 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:55.206 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:55.207 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:55.209 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:55.210 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:55.212 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:55.212 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:55.212 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8FuBqvJbe1BMn8cXC_nEjguMMScTY4DFU8b7ALd9DKJCWkUI0KNgRJW9zChlPuWMtja_Ex-brk4m7PwMr5a16koHn1SGSvkhFyEUbXfwsmTwNiyJXCz5TF_Pzdt5OHOxdEObDsC47_Wg6pREyQ2vgDAYu_mjVb39HNg0sE2w7qZVlTPKeaPWYY1fOZiIHLUZydeFFhQGXL8linrBsrtDh-U1p7IdmnV9SqjX5cyDDRqx21eqE27XobhqFeLnAa-Q3GVooW6FvRyDf0Tei0iGhjKFthSf5HnKLlR4txr9i0oAjJUOEj6e9U7Wwwp9YGv1x2ijJhE1ftfMzE9xno2s2i0","UiLocales":null,"Nonce":"637042181318619833.MGZhNTk2ZTAtZGYzMS00MjE2LWE3ZDctYzg3ZDNlNGNhNWJmMTNhZTkzMjYtN2U1MC00NTk1LWIwOWEtNGQ2ZDlkZDg2OTVh","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"502886bbc3196d6d0159628824947879","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042181318619833.MGZhNTk2ZTAtZGYzMS00MjE2LWE3ZDctYzg3ZDNlNGNhNWJmMTNhZTkzMjYtN2U1MC00NTk1LWIwOWEtNGQ2ZDlkZDg2OTVh","state":"CfDJ8FuBqvJbe1BMn8cXC_nEjguMMScTY4DFU8b7ALd9DKJCWkUI0KNgRJW9zChlPuWMtja_Ex-brk4m7PwMr5a16koHn1SGSvkhFyEUbXfwsmTwNiyJXCz5TF_Pzdt5OHOxdEObDsC47_Wg6pREyQ2vgDAYu_mjVb39HNg0sE2w7qZVlTPKeaPWYY1fOZiIHLUZydeFFhQGXL8linrBsrtDh-U1p7IdmnV9SqjX5cyDDRqx21eqE27XobhqFeLnAa-Q3GVooW6FvRyDf0Tei0iGhjKFthSf5HnKLlR4txr9i0oAjJUOEj6e9U7Wwwp9YGv1x2ijJhE1ftfMzE9xno2s2i0","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 15:08:55.212 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 15:08:55.212 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 15:08:55.212 +07:00 [INF] Showing consent: User has not yet consented
2019-09-16 15:08:55.218 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:55.221 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:55.221 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:55.221 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:55.221 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:55.222 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:55.224 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:55.225 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:55.227 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:55.227 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:55.229 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:55.229 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:55.230 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:55.231 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:56.619 +07:00 [DBG] CORS request made for path: /consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-09-16 15:08:56.621 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:56.626 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:56.626 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:56.626 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:56.626 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:56.627 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:56.629 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:56.630 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:56.632 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:56.632 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:56.634 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:56.635 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:56.639 +07:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-09-16 15:08:56.639 +07:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-09-16 15:08:56.640 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-09-16 15:08:56.640 +07:00 [DBG] Start authorize callback request
2019-09-16 15:08:56.640 +07:00 [DBG] User in authorize request: 2
2019-09-16 15:08:56.640 +07:00 [DBG] Start authorize request protocol validation
2019-09-16 15:08:56.642 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:56.642 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:56.642 +07:00 [DBG] Checking for PKCE parameters
2019-09-16 15:08:56.642 +07:00 [DBG] No PKCE used.
2019-09-16 15:08:56.643 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:56.645 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:56.646 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:56.649 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:56.649 +07:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-09-16 15:08:56.649 +07:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"2","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 offline_access","State":"CfDJ8FuBqvJbe1BMn8cXC_nEjguMMScTY4DFU8b7ALd9DKJCWkUI0KNgRJW9zChlPuWMtja_Ex-brk4m7PwMr5a16koHn1SGSvkhFyEUbXfwsmTwNiyJXCz5TF_Pzdt5OHOxdEObDsC47_Wg6pREyQ2vgDAYu_mjVb39HNg0sE2w7qZVlTPKeaPWYY1fOZiIHLUZydeFFhQGXL8linrBsrtDh-U1p7IdmnV9SqjX5cyDDRqx21eqE27XobhqFeLnAa-Q3GVooW6FvRyDf0Tei0iGhjKFthSf5HnKLlR4txr9i0oAjJUOEj6e9U7Wwwp9YGv1x2ijJhE1ftfMzE9xno2s2i0","UiLocales":null,"Nonce":"637042181318619833.MGZhNTk2ZTAtZGYzMS00MjE2LWE3ZDctYzg3ZDNlNGNhNWJmMTNhZTkzMjYtN2U1MC00NTk1LWIwOWEtNGQ2ZDlkZDg2OTVh","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"502886bbc3196d6d0159628824947879","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 offline_access","response_mode":"form_post","nonce":"637042181318619833.MGZhNTk2ZTAtZGYzMS00MjE2LWE3ZDctYzg3ZDNlNGNhNWJmMTNhZTkzMjYtN2U1MC00NTk1LWIwOWEtNGQ2ZDlkZDg2OTVh","state":"CfDJ8FuBqvJbe1BMn8cXC_nEjguMMScTY4DFU8b7ALd9DKJCWkUI0KNgRJW9zChlPuWMtja_Ex-brk4m7PwMr5a16koHn1SGSvkhFyEUbXfwsmTwNiyJXCz5TF_Pzdt5OHOxdEObDsC47_Wg6pREyQ2vgDAYu_mjVb39HNg0sE2w7qZVlTPKeaPWYY1fOZiIHLUZydeFFhQGXL8linrBsrtDh-U1p7IdmnV9SqjX5cyDDRqx21eqE27XobhqFeLnAa-Q3GVooW6FvRyDf0Tei0iGhjKFthSf5HnKLlR4txr9i0oAjJUOEj6e9U7Wwwp9YGv1x2ijJhE1ftfMzE9xno2s2i0","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-09-16 15:08:56.649 +07:00 [DBG] IsActive called from: AuthorizeEndpoint
2019-09-16 15:08:56.649 +07:00 [DBG] Scopes contains offline_access, consent is required
2019-09-16 15:08:56.649 +07:00 [INF] User consented to scopes: ["profile","openid","api1","offline_access"]
2019-09-16 15:08:56.649 +07:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","api1","offline_access"]
2019-09-16 15:08:56.649 +07:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 2
2019-09-16 15:08:56.650 +07:00 [DBG] QIM5q/EfBaHTA6V377/X6CDksjn7Imin78ZZLT1RY0E= found in database
2019-09-16 15:08:56.653 +07:00 [DBG] Creating Hybrid Flow response.
2019-09-16 15:08:56.654 +07:00 [DBG] stGPX8uPaFM3pwxt/nZuxdFbSqX7ZzG55NKE/t1ox1g= not found in database
2019-09-16 15:08:56.655 +07:00 [DBG] Creating Implicit Flow response.
2019-09-16 15:08:56.655 +07:00 [DBG] Getting claims for identity token for subject: 2 and client: mvc
2019-09-16 15:08:56.655 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-09-16 15:08:56.657 +07:00 [DBG] Authorize endpoint response
{"SubjectId":"2","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8FuBqvJbe1BMn8cXC_nEjguMMScTY4DFU8b7ALd9DKJCWkUI0KNgRJW9zChlPuWMtja_Ex-brk4m7PwMr5a16koHn1SGSvkhFyEUbXfwsmTwNiyJXCz5TF_Pzdt5OHOxdEObDsC47_Wg6pREyQ2vgDAYu_mjVb39HNg0sE2w7qZVlTPKeaPWYY1fOZiIHLUZydeFFhQGXL8linrBsrtDh-U1p7IdmnV9SqjX5cyDDRqx21eqE27XobhqFeLnAa-Q3GVooW6FvRyDf0Tei0iGhjKFthSf5HnKLlR4txr9i0oAjJUOEj6e9U7Wwwp9YGv1x2ijJhE1ftfMzE9xno2s2i0","Scope":"openid profile api1 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-09-16 15:08:56.657 +07:00 [DBG] Augmenting SignInContext
2019-09-16 15:08:56.657 +07:00 [INF] AuthenticationScheme: idsrv signed in.
2019-09-16 15:08:56.680 +07:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-09-16 15:08:56.680 +07:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-09-16 15:08:56.680 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-09-16 15:08:56.680 +07:00 [DBG] Start token request.
2019-09-16 15:08:56.680 +07:00 [DBG] Start client validation
2019-09-16 15:08:56.680 +07:00 [DBG] Start parsing Basic Authentication secret
2019-09-16 15:08:56.680 +07:00 [DBG] Start parsing for secret in post body
2019-09-16 15:08:56.680 +07:00 [DBG] Parser found secret: PostBodySecretParser
2019-09-16 15:08:56.680 +07:00 [DBG] Secret id found: mvc
2019-09-16 15:08:56.684 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:56.684 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:56.685 +07:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-09-16 15:08:56.685 +07:00 [DBG] Client validation success
2019-09-16 15:08:56.685 +07:00 [DBG] Start token request validation
2019-09-16 15:08:56.686 +07:00 [DBG] Start validation of authorization code token request
2019-09-16 15:08:56.688 +07:00 [DBG] stGPX8uPaFM3pwxt/nZuxdFbSqX7ZzG55NKE/t1ox1g= found in database: true
2019-09-16 15:08:56.689 +07:00 [DBG] removing stGPX8uPaFM3pwxt/nZuxdFbSqX7ZzG55NKE/t1ox1g= persisted grant from database
2019-09-16 15:08:56.690 +07:00 [DBG] IsActive called from: AuthorizationCodeValidation
2019-09-16 15:08:56.690 +07:00 [DBG] Validation of authorization code token request success
2019-09-16 15:08:56.690 +07:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"0ac749867e3efc803a777cd15179a6ef7dbbb7ed5f1c05bac642c2b80c42290e","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"0ac749867e3efc803a777cd15179a6ef7dbbb7ed5f1c05bac642c2b80c42290e","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-09-16 15:08:56.693 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:56.693 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:56.694 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:56.697 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:56.697 +07:00 [DBG] Getting claims for access token for client: mvc
2019-09-16 15:08:56.697 +07:00 [DBG] Getting claims for access token for subject: 2
2019-09-16 15:08:56.697 +07:00 [DBG] Get profile called for subject 2 from client MVC Client with claim types [] via ClaimsProviderAccessToken
2019-09-16 15:08:56.697 +07:00 [DBG] Issued claims: []
2019-09-16 15:08:56.698 +07:00 [DBG] Creating refresh token
2019-09-16 15:08:56.699 +07:00 [DBG] Setting an absolute lifetime: 2592000
2019-09-16 15:08:56.699 +07:00 [DBG] vTwxSXueG9vXuGEaz4Bjy3B7/1OSGlA+EKgt321nSDQ= not found in database
2019-09-16 15:08:56.706 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:56.706 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:56.707 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:56.710 +07:00 [DBG] Found ["api1"] API scopes in database
2019-09-16 15:08:56.710 +07:00 [DBG] Getting claims for identity token for subject: 2 and client: mvc
2019-09-16 15:08:56.710 +07:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-09-16 15:08:56.711 +07:00 [DBG] Token request success.
2019-09-16 15:08:56.713 +07:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-09-16 15:08:56.713 +07:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-09-16 15:08:56.713 +07:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-09-16 15:08:56.714 +07:00 [DBG] Start userinfo request
2019-09-16 15:08:56.714 +07:00 [DBG] Bearer token found in header
2019-09-16 15:08:56.717 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:56.717 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:56.721 +07:00 [DBG] mvc found in database: true
2019-09-16 15:08:56.721 +07:00 [DBG] client configuration validation for client mvc succeeded.
2019-09-16 15:08:56.722 +07:00 [DBG] IsActive called from: AccessTokenValidation
2019-09-16 15:08:56.722 +07:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-09-16 15:08:56.722 +07:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1568621336,"exp":1568624936,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"2","auth_time":1568621335,"idp":"local","scope":["profile","openid","api1","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-09-16 15:08:56.722 +07:00 [DBG] IsActive called from: UserInfoRequestValidation
2019-09-16 15:08:56.722 +07:00 [DBG] Creating userinfo response
2019-09-16 15:08:56.722 +07:00 [DBG] Scopes in access token: profile openid api1 offline_access
2019-09-16 15:08:56.722 +07:00 [DBG] Scopes in access token: profile openid api1 offline_access
2019-09-16 15:08:56.723 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:56.723 +07:00 [DBG] Requested claim types: updated_at locale zoneinfo birthdate gender website picture profile preferred_username nickname middle_name given_name family_name name sub
2019-09-16 15:08:56.723 +07:00 [DBG] Scopes in access token: profile openid api1 offline_access
2019-09-16 15:08:56.724 +07:00 [DBG] Found ["profile","openid"] identity scopes in database
2019-09-16 15:08:56.724 +07:00 [DBG] Get profile called for subject 2 from client MVC Client with claim types ["updated_at","locale","zoneinfo","birthdate","gender","website","picture","profile","preferred_username","nickname","middle_name","given_name","family_name","name","sub"] via UserInfoEndpoint
2019-09-16 15:08:56.724 +07:00 [DBG] Issued claims: ["name","website"]
2019-09-16 15:08:56.724 +07:00 [INF] Profile service returned the following claim types: name website
2019-09-16 15:08:56.724 +07:00 [DBG] End userinfo request
2019-09-16 15:29:01.381 +07:00 [DBG] Stopping grant removal
2019-09-16 15:29:01.383 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-16 16:47:43.786 +07:00 [WRN] Using an in-memory repository. Keys will not be persisted to storage.
2019-09-16 16:47:43.808 +07:00 [WRN] Neither user profile nor HKLM registry available. Using an ephemeral key repository. Protected data will be unavailable when application exits.
2019-09-16 16:47:43.821 +07:00 [WRN] No XML encryptor configured. Key "86b643fc-c7ad-4d3f-bf9e-44032fbe02d5" may be persisted to storage in unencrypted form.
2019-09-16 16:47:45.377 +07:00 [INF] Starting IdentityServer4 version 2.5.0.0
2019-09-16 16:47:45.393 +07:00 [INF] Using the default authentication scheme idsrv for IdentityServer
2019-09-16 16:47:45.394 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for authentication
2019-09-16 16:47:45.394 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-in
2019-09-16 16:47:45.394 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for sign-out
2019-09-16 16:47:45.394 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for challenge
2019-09-16 16:47:45.394 +07:00 [DBG] Using idsrv as default ASP.NET Core scheme for forbid
2019-09-16 16:47:45.475 +07:00 [DBG] Starting grant removal
2019-09-16 16:47:45.713 +07:00 [DBG] Login Url: /Account/Login
2019-09-16 16:47:45.715 +07:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-09-16 16:47:45.715 +07:00 [DBG] Logout Url: /Account/Logout
2019-09-16 16:47:45.715 +07:00 [DBG] ConsentUrl Url: /consent
2019-09-16 16:47:45.715 +07:00 [DBG] Consent Return Url Parameter: returnUrl
2019-09-16 16:47:45.715 +07:00 [DBG] Error Url: /home/error
2019-09-16 16:47:45.715 +07:00 [DBG] Error Id Parameter: errorId
2019-09-16 16:47:45.721 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 16:47:45.737 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 16:47:45.825 +07:00 [INF] Homepage is disabled in production. Returning 404.
2019-09-16 16:47:49.218 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 16:47:49.218 +07:00 [INF] idsrv was not authenticated. Failure message: Unprotect ticket failed
2019-09-16 16:47:49.316 +07:00 [ERR] An exception was thrown while deserializing the token.
Microsoft.AspNetCore.Antiforgery.AntiforgeryValidationException: The antiforgery token could not be decrypted. ---> System.Security.Cryptography.CryptographicException: The key {ad657c10-9313-4ae0-bffe-c5070eedeefe} was not found in the key ring.
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.UnprotectCore(Byte[] protectedData, Boolean allowOperationsOnRevokedKeys, UnprotectStatus& status)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.DangerousUnprotect(Byte[] protectedData, Boolean ignoreRevocationErrors, Boolean& requiresMigration, Boolean& wasRevoked)
   at Microsoft.AspNetCore.DataProtection.KeyManagement.KeyRingBasedDataProtector.Unprotect(Byte[] protectedData)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgeryTokenSerializer.Deserialize(String serializedToken)
   at Microsoft.AspNetCore.Antiforgery.Internal.DefaultAntiforgery.GetCookieTokenDoesNotThrow(HttpContext httpContext)
2019-09-16 16:47:53.726 +07:00 [DBG] Stopping grant removal
2019-09-16 16:47:53.727 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-17 14:31:39.074 +07:00 [FTL] Application startup exception
System.InvalidOperationException: Decorator already registered for type: IAuthenticationService.
   at Microsoft.Extensions.DependencyInjection.IdentityServerBuilderExtensionsCore.AddDecorator[TService](IServiceCollection services)
   at Microsoft.Extensions.DependencyInjection.IdentityServerBuilderExtensionsCore.AddCookieAuthentication(IIdentityServerBuilder builder)
   at Microsoft.Extensions.DependencyInjection.IdentityServerServiceCollectionExtensions.AddIdentityServer(IServiceCollection services)
   at IdentityServer.Startup.ConfigureServices(IServiceCollection services) in D:\Project\identityserver\src\IdentityServer\Startup.cs:line 107
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.ConfigureServices(IServiceCollection services)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.EnsureApplicationServices()
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.Initialize()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2019-09-17 14:31:39.173 +07:00 [DBG] Starting grant removal
2019-09-17 14:45:12.118 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-17 14:45:12.152 +07:00 [DBG] Stopping grant removal
2019-09-17 14:46:27.936 +07:00 [FTL] Application startup exception
System.InvalidOperationException: Decorator already registered for type: IAuthenticationService.
   at Microsoft.Extensions.DependencyInjection.IdentityServerBuilderExtensionsCore.AddDecorator[TService](IServiceCollection services)
   at Microsoft.Extensions.DependencyInjection.IdentityServerBuilderExtensionsCore.AddCookieAuthentication(IIdentityServerBuilder builder)
   at Microsoft.Extensions.DependencyInjection.IdentityServerServiceCollectionExtensions.AddIdentityServer(IServiceCollection services)
   at IdentityServer.Startup.ConfigureServices(IServiceCollection services) in D:\Project\identityserver\src\IdentityServer\Startup.cs:line 107
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.ConfigureServices(IServiceCollection services)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.EnsureApplicationServices()
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.Initialize()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2019-09-17 14:46:27.999 +07:00 [DBG] Starting grant removal
2019-09-17 14:49:07.397 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-17 14:49:07.406 +07:00 [DBG] Stopping grant removal
2019-09-17 14:49:34.244 +07:00 [FTL] Application startup exception
System.InvalidOperationException: Decorator already registered for type: IAuthenticationService.
   at Microsoft.Extensions.DependencyInjection.IdentityServerBuilderExtensionsCore.AddDecorator[TService](IServiceCollection services)
   at Microsoft.Extensions.DependencyInjection.IdentityServerBuilderExtensionsCore.AddCookieAuthentication(IIdentityServerBuilder builder)
   at Microsoft.Extensions.DependencyInjection.IdentityServerServiceCollectionExtensions.AddIdentityServer(IServiceCollection services)
   at IdentityServer.Startup.ConfigureServices(IServiceCollection services) in D:\Project\identityserver\src\IdentityServer\Startup.cs:line 107
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.ConfigureServices(IServiceCollection services)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.EnsureApplicationServices()
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.Initialize()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2019-09-17 14:49:34.320 +07:00 [DBG] Starting grant removal
2019-09-17 14:52:43.996 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-17 14:52:44.006 +07:00 [DBG] Stopping grant removal
2019-09-18 11:19:49.766 +07:00 [FTL] Application startup exception
System.InvalidOperationException: Decorator already registered for type: IAuthenticationService.
   at Microsoft.Extensions.DependencyInjection.IdentityServerBuilderExtensionsCore.AddDecorator[TService](IServiceCollection services)
   at Microsoft.Extensions.DependencyInjection.IdentityServerBuilderExtensionsCore.AddCookieAuthentication(IIdentityServerBuilder builder)
   at Microsoft.Extensions.DependencyInjection.IdentityServerServiceCollectionExtensions.AddIdentityServer(IServiceCollection services)
   at IdentityServer.Startup.ConfigureServices(IServiceCollection services) in D:\Project\identityserver\src\IdentityServer\Startup.cs:line 107
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.ConfigureServices(IServiceCollection services)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.EnsureApplicationServices()
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.Initialize()
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2019-09-18 11:19:49.846 +07:00 [DBG] Starting grant removal
2019-09-18 11:20:17.478 +07:00 [DBG] TaskCanceledException. Exiting.
2019-09-18 11:20:17.489 +07:00 [DBG] Stopping grant removal
